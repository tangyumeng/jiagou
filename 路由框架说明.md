# è·¯ç”±æ¡†æ¶ - URL-Based Router

## ğŸ“¦ åŠŸèƒ½æ¦‚è¿°

å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ **URL-Based è·¯ç”±æ¡†æ¶**ï¼Œè§£å†³ iOS åº”ç”¨ä¸­**æ¨¡å—é—´é¡µé¢è·³è½¬è§£è€¦**çš„é—®é¢˜ï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±ã€å‚æ•°ä¼ é€’ã€æ‹¦æˆªå™¨ç­‰åŠŸèƒ½ã€‚

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### 1. **URL æ¨¡å¼åŒ¹é…**
```
æ”¯æŒå ä½ç¬¦ï¼š
app://user/:userId          â†’  app://user/123
app://product/:id/detail    â†’  app://product/456/detail

æ”¯æŒ Query å‚æ•°ï¼š
app://search?keyword=iPhone&page=1
```

### 2. **å¤šç§è·³è½¬æ–¹å¼**
- âœ… **Push** - å¯¼èˆªæ  push
- âœ… **Present** - æ¨¡æ€å¼¹å‡º
- âœ… **Replace** - æ›¿æ¢å½“å‰é¡µé¢
- âœ… **Custom** - è‡ªå®šä¹‰è·³è½¬æ–¹å¼

### 3. **å‚æ•°ä¼ é€’**
- âœ… **è·¯å¾„å‚æ•°** - `/user/:userId` â†’ `userId=123`
- âœ… **Query å‚æ•°** - `?name=å¼ ä¸‰&age=25`
- âœ… **é¢å¤–å‚æ•°** - ä»£ç ä¸­ä¼ é€’çš„ Dictionary

### 4. **æ‹¦æˆªå™¨ï¼ˆä¸­é—´ä»¶ï¼‰**
- âœ… ç™»å½•éªŒè¯
- âœ… æƒé™æ£€æŸ¥
- âœ… åŸ‹ç‚¹ç»Ÿè®¡
- âœ… å‚æ•°æ ¡éªŒ

### 5. **åè®®è§£è€¦**
- âœ… Routable åè®®
- âœ… è‡ªåŠ¨å®ä¾‹åŒ– ViewController
- âœ… æ¨¡å—é—´é›¶è€¦åˆ

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Routerï¼ˆå•ä¾‹ï¼‰            â”‚
â”‚       - è·¯ç”±è¡¨ç®¡ç†                   â”‚
â”‚       - URL åŒ¹é…                     â”‚
â”‚       - è·³è½¬æ‰§è¡Œ                     â”‚
â”‚       - æ‹¦æˆªå™¨ç®¡ç†                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ RouteInfo  â”‚    â”‚ RouteRequest â”‚
â”‚ - pattern  â”‚    â”‚ - url        â”‚
â”‚ - action   â”‚    â”‚ - parameters â”‚
â”‚ - handler  â”‚    â”‚ - source     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  Routable  â”‚    â”‚ Interceptor  â”‚
â”‚  åè®®      â”‚    â”‚ æ‹¦æˆªå™¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è·¯ç”±åŒ¹é…æµç¨‹

```
  è¾“å…¥ URLï¼šapp://user/123?name=å¼ ä¸‰
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚ è§£æ URL â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ åŒ¹é…è·¯ç”±è¡¨    â”‚
  â”‚ app://user/:userId â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æå–å‚æ•°      â”‚
  â”‚ userId = 123  â”‚
  â”‚ name = å¼ ä¸‰   â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æ‰§è¡Œæ‹¦æˆªå™¨    â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ åˆ›å»º VC       â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æ‰§è¡Œè·³è½¬      â”‚
  â”‚ (push/present)â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» ä½¿ç”¨æ–¹æ³•

### 1. æ³¨å†Œè·¯ç”±ï¼ˆAppDelegateï¼‰

```swift
import UIKit

func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
    
    // æ³¨å†Œè·¯ç”±
    registerRoutes()
    
    return true
}

func registerRoutes() {
    let router = Router.shared
    
    // æ–¹å¼1ï¼šä½¿ç”¨ Routable åè®®ï¼ˆæ¨èï¼‰
    router.register(
        "app://user/:userId",
        viewControllerType: UserDetailViewController.self,
        action: .push
    )
    
    // æ–¹å¼2ï¼šä½¿ç”¨é—­åŒ…
    router.register("app://product/:productId", action: .push) { parameters in
        let vc = ProductDetailViewController()
        vc.productId = parameters["productId"] as? String
        return vc
    }
    
    // æ–¹å¼3ï¼šæ¨¡æ€å¼¹å‡º
    router.register("app://settings", action: .present) { _ in
        let vc = SettingsViewController()
        return UINavigationController(rootViewController: vc)
    }
}
```

### 2. ViewController å®ç° Routable åè®®

```swift
class UserDetailViewController: UIViewController, Routable {
    
    var userId: String?
    var userName: String?
    
    // MARK: - Routable åè®®
    
    static func instantiate(with parameters: [String: Any]) -> Self? {
        let vc = Self()
        vc.userId = parameters["userId"] as? String
        vc.userName = parameters["name"] as? String
        return vc
    }
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        title = "ç”¨æˆ·è¯¦æƒ…"
        print("ç”¨æˆ·IDï¼š\(userId ?? "")")
        print("ç”¨æˆ·åï¼š\(userName ?? "")")
    }
}
```

### 3. æ‰“å¼€é¡µé¢

```swift
// æ–¹å¼1ï¼šåŸºæœ¬ä½¿ç”¨
Router.shared.open("app://user/123")

// æ–¹å¼2ï¼šå¸¦é¢å¤–å‚æ•°
Router.shared.open("app://user/123", parameters: ["name": "å¼ ä¸‰", "age": 25])

// æ–¹å¼3ï¼šå¸¦ Query å‚æ•°
Router.shared.open("app://product/456?name=iPhone&price=5999")

// æ–¹å¼4ï¼šæŒ‡å®šæº ViewController
Router.shared.open("app://settings", from: self)

// æ–¹å¼5ï¼šå¸¦å®Œæˆå›è°ƒ
Router.shared.open("app://user/123") {
    print("é¡µé¢å·²æ‰“å¼€")
}

// æ–¹å¼6ï¼šUIViewController æ‰©å±•ï¼ˆæ›´ç®€æ´ï¼‰
self.open("app://user/123")
self.open("app://product/456", parameters: ["name": "iPhone"])
```

### 4. è¿”å›å’Œå…³é—­

```swift
// è¿”å›ä¸Šä¸€é¡µ
Router.shared.open("app://back")
self.routeBack()

// å…³é—­æ¨¡æ€
Router.shared.open("app://dismiss")
self.routeDismiss()
```

### 5. æ·»åŠ æ‹¦æˆªå™¨ï¼ˆä¸­é—´ä»¶ï¼‰

```swift
// ç™»å½•éªŒè¯æ‹¦æˆªå™¨
Router.shared.addInterceptor { request in
    // éœ€è¦ç™»å½•çš„é¡µé¢
    let needsLogin = request.url.absoluteString.contains("/user/")
    
    if needsLogin {
        let isLoggedIn = UserDefaults.standard.bool(forKey: "isLoggedIn")
        
        if !isLoggedIn {
            print("â›” éœ€è¦ç™»å½•")
            // è·³è½¬åˆ°ç™»å½•é¡µ
            Router.shared.open("app://login")
            return false  // æ‹¦æˆª
        }
    }
    
    return true  // é€šè¿‡
}

// åŸ‹ç‚¹ç»Ÿè®¡æ‹¦æˆªå™¨
Router.shared.addInterceptor { request in
    print("ğŸ“Š ç»Ÿè®¡ï¼šæ‰“å¼€é¡µé¢ \(request.url)")
    // å‘é€åŸ‹ç‚¹æ•°æ®...
    return true
}

// å‚æ•°æ ¡éªŒæ‹¦æˆªå™¨
Router.shared.addInterceptor { request in
    if request.url.path.contains("/product/") {
        guard let productId = request.parameters["productId"] as? String,
              !productId.isEmpty else {
            print("âŒ å•†å“IDä¸èƒ½ä¸ºç©º")
            return false
        }
    }
    return true
}
```

### 6. å¤„ç†å¤–éƒ¨ URL

```swift
// AppDelegate / SceneDelegate

// æ–¹å¼1ï¼šURL Scheme
func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey: Any] = [:]) -> Bool {
    // myapp://user/123
    return Router.shared.open(url)
}

// æ–¹å¼2ï¼šUniversal Linksï¼ˆé€šç”¨é“¾æ¥ï¼‰
func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
    
    if userActivity.activityType == NSUserActivityTypeBrowsingWeb,
       let url = userActivity.webpageURL {
        // https://www.myapp.com/user/123
        // éœ€è¦è½¬æ¢ä¸ºå†…éƒ¨è·¯ç”±æ ¼å¼
        let internalURL = convertToInternalURL(url)
        return Router.shared.open(internalURL)
    }
    
    return false
}

func convertToInternalURL(_ externalURL: URL) -> URL {
    // https://www.myapp.com/user/123 â†’ app://user/123
    var components = URLComponents(url: externalURL, resolvingAgainstBaseURL: false)
    components?.scheme = "app"
    components?.host = nil
    return components?.url ?? externalURL
}
```

### 7. åŠ¨æ€æ³¨å†Œå’Œæ³¨é”€

```swift
// åŠ¨æ€æ³¨å†Œï¼ˆä¾‹å¦‚ï¼šæŸä¸ªåŠŸèƒ½æ¨¡å—åŠ è½½åï¼‰
Router.shared.register("app://premium/:featureId") { parameters in
    return PremiumFeatureViewController.instantiate(with: parameters)
}

// æ³¨é”€è·¯ç”±ï¼ˆä¾‹å¦‚ï¼šåŠŸèƒ½ä¸‹çº¿ï¼‰
Router.shared.unregister("app://premium/:featureId")
```

---

## ğŸ¯ æ ¸å¿ƒæŠ€æœ¯å®ç°

### 1. URL æ¨¡å¼åŒ¹é…

```swift
// è¾“å…¥ï¼š
urlPath = "/user/123"
patternPath = "/user/:userId"

// åŒ¹é…é€»è¾‘ï¼š
let urlComponents = ["/", "user", "123"]
let patternComponents = ["/", "user", ":userId"]

// éå†æ¯”è¾ƒï¼š
for (urlComp, patternComp) in zip(urlComponents, patternComponents) {
    if patternComp.hasPrefix(":") {
        // å‚æ•°å ä½ç¬¦ï¼Œæå–å‚æ•°
        let key = "userId"
        parameters[key] = "123"
    } else if urlComp != patternComp {
        // ä¸åŒ¹é…
        return nil
    }
}

// ç»“æœï¼š
parameters = ["userId": "123"]
```

### 2. å‚æ•°åˆå¹¶

```swift
// ä¸‰ç§å‚æ•°æ¥æºï¼š
1. è·¯å¾„å‚æ•°ï¼š/user/:userId â†’ ["userId": "123"]
2. Query å‚æ•°ï¼š?name=å¼ ä¸‰&age=25 â†’ ["name": "å¼ ä¸‰", "age": 25]
3. ä»£ç å‚æ•°ï¼šparameters: ["vip": true]

// åˆå¹¶ç­–ç•¥ï¼ˆåè€…è¦†ç›–å‰è€…ï¼‰ï¼š
var allParameters = pathParameters
allParameters.merge(queryParameters) { $1 }  // Query è¦†ç›– Path
allParameters.merge(codeParameters) { $1 }   // Code è¦†ç›– Query

// æœ€ç»ˆå‚æ•°ï¼š
["userId": "123", "name": "å¼ ä¸‰", "age": 25, "vip": true]
```

### 3. è·å–å½“å‰ ViewController

```swift
// é€’å½’æŸ¥æ‰¾å½“å‰æ˜¾ç¤ºçš„ ViewController
func currentViewController() -> UIViewController? {
    guard let window = keyWindow,
          let root = window.rootViewController else {
        return nil
    }
    
    return findCurrent(from: root)
}

func findCurrent(from vc: UIViewController) -> UIViewController {
    // 1. å¦‚æœæœ‰ presentedï¼Œä¼˜å…ˆè¿”å›
    if let presented = vc.presentedViewController {
        return findCurrent(from: presented)
    }
    
    // 2. NavigationController
    if let nav = vc as? UINavigationController {
        if let visible = nav.visibleViewController {
            return findCurrent(from: visible)
        }
    }
    
    // 3. TabBarController
    if let tab = vc as? UITabBarController {
        if let selected = tab.selectedViewController {
            return findCurrent(from: selected)
        }
    }
    
    return vc
}
```

### 4. Routable åè®®

```swift
protocol Routable {
    static func instantiate(with parameters: [String: Any]) -> Self?
}

// å¥½å¤„ï¼š
// âœ… ç»Ÿä¸€çš„å®ä¾‹åŒ–æ¥å£
// âœ… å‚æ•°è‡ªåŠ¨ä¼ é€’
// âœ… ç±»å‹å®‰å…¨
// âœ… è§£è€¦

// ä½¿ç”¨ï¼š
router.register(
    "app://user/:userId",
    viewControllerType: UserDetailViewController.self  // ä¼ é€’ç±»å‹å³å¯
)
```

---

## ğŸ“Š ä¼˜åŠ¿åˆ†æ

### vs ä¼ ç»Ÿè·³è½¬æ–¹å¼

| å¯¹æ¯”é¡¹ | ä¼ ç»Ÿæ–¹å¼ | è·¯ç”±æ–¹å¼ |
|--------|---------|---------|
| è€¦åˆåº¦ | é«˜ï¼ˆç›´æ¥ä¾èµ–ç±»ï¼‰ | ä½ï¼ˆé€šè¿‡ URLï¼‰ |
| æ¨¡å—åŒ– | å›°éš¾ | å®¹æ˜“ |
| å¤–éƒ¨å”¤èµ· | å¤æ‚ | ç®€å• |
| å‚æ•°ä¼ é€’ | æ‰‹åŠ¨ | è‡ªåŠ¨ |
| ç»Ÿä¸€ç®¡ç† | åˆ†æ•£ | é›†ä¸­ |
| åŸ‹ç‚¹ç»Ÿè®¡ | åˆ†æ•£ | ç»Ÿä¸€ |
| æƒé™æ§åˆ¶ | åˆ†æ•£ | ç»Ÿä¸€ |

### ä¼ ç»Ÿæ–¹å¼

```swift
// âŒ é—®é¢˜1ï¼šç´§è€¦åˆ
import UserModule  // ä¾èµ–å…¶ä»–æ¨¡å—

let vc = UserDetailViewController()  // ç›´æ¥åˆ›å»º
vc.userId = "123"
navigationController?.pushViewController(vc, animated: true)

// âŒ é—®é¢˜2ï¼šå¤–éƒ¨å”¤èµ·å›°éš¾
// éœ€è¦åœ¨ AppDelegate ä¸­å†™å¤§é‡ if-else

// âŒ é—®é¢˜3ï¼šæƒé™æ§åˆ¶åˆ†æ•£
// æ¯ä¸ªé¡µé¢éƒ½è¦æ£€æŸ¥æƒé™

// âŒ é—®é¢˜4ï¼šåŸ‹ç‚¹åˆ†æ•£
// æ¯ä¸ªé¡µé¢è·³è½¬éƒ½è¦æ‰‹åŠ¨åŸ‹ç‚¹
```

### è·¯ç”±æ–¹å¼

```swift
// âœ… ä¼˜ç‚¹1ï¼šè§£è€¦
Router.shared.open("app://user/123")  // æ— éœ€ import

// âœ… ä¼˜ç‚¹2ï¼šå¤–éƒ¨å”¤èµ·ç®€å•
func application(_ app: UIApplication, open url: URL) -> Bool {
    return Router.shared.open(url)  // ä¸€è¡Œä»£ç 
}

// âœ… ä¼˜ç‚¹3ï¼šç»Ÿä¸€æƒé™æ§åˆ¶
Router.shared.addInterceptor { request in
    // ç»Ÿä¸€æ£€æŸ¥æƒé™
    return checkPermission(request.url)
}

// âœ… ä¼˜ç‚¹4ï¼šç»Ÿä¸€åŸ‹ç‚¹
Router.shared.addInterceptor { request in
    // ç»Ÿä¸€åŸ‹ç‚¹
    Analytics.track("page_view", url: request.url)
    return true
}
```

---

## ğŸ¤ é¢è¯•è¦ç‚¹

### 1. ä¸ºä»€ä¹ˆéœ€è¦è·¯ç”±ï¼Ÿ

```
é—®é¢˜èƒŒæ™¯ï¼š
- æ¨¡å—é—´é¡µé¢è·³è½¬ç´§è€¦åˆ
- å¤–éƒ¨ URL å”¤èµ·å¤æ‚
- æƒé™æ§åˆ¶ã€åŸ‹ç‚¹ç»Ÿè®¡åˆ†æ•£
- ç»„ä»¶åŒ–ã€æ¨¡å—åŒ–å›°éš¾

è§£å†³æ–¹æ¡ˆï¼š
- è·¯ç”±å±‚è§£è€¦ï¼ˆé€šè¿‡ URLï¼‰
- ç»Ÿä¸€è·³è½¬å…¥å£
- æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç†
- æ”¯æŒåŠ¨æ€æ³¨å†Œ
```

### 2. URL-Based vs Protocol-Basedï¼Ÿ

```swift
// URL-Basedï¼ˆæœ¬æ¡†æ¶ï¼‰
Router.shared.open("app://user/123")

ä¼˜ç‚¹ï¼š
âœ… æ”¯æŒå¤–éƒ¨å”¤èµ·ï¼ˆURL Scheme / Universal Linksï¼‰
âœ… æ”¯æŒåŠ¨æ€è·¯ç”±ï¼ˆè¿è¡Œæ—¶æ³¨å†Œï¼‰
âœ… å­—ç¬¦ä¸²ä¼ é€’ï¼Œè·¨è¯­è¨€ã€è·¨å¹³å°
âœ… é…ç½®åŒ–ï¼ˆå¯ä»æœåŠ¡å™¨ä¸‹å‘è·¯ç”±è¡¨ï¼‰

ç¼ºç‚¹ï¼š
âŒ ç±»å‹ä¸å®‰å…¨ï¼ˆå­—ç¬¦ä¸²ï¼‰
âŒ ç¼–è¯‘æ—¶æ— æ³•æ£€æŸ¥é”™è¯¯
âŒ å‚æ•°ä¼ é€’å—é™ï¼ˆåªèƒ½æ˜¯åŸºæœ¬ç±»å‹ï¼‰

// Protocol-Based
let navigator = container.resolve(UserNavigator.self)
navigator.navigateToUserDetail(userId: "123", user: userObject)

ä¼˜ç‚¹ï¼š
âœ… ç±»å‹å®‰å…¨
âœ… ç¼–è¯‘æ—¶æ£€æŸ¥
âœ… æ”¯æŒå¤æ‚å¯¹è±¡ä¼ é€’
âœ… IDE è‡ªåŠ¨è¡¥å…¨

ç¼ºç‚¹ï¼š
âŒ ä¸æ”¯æŒå¤–éƒ¨å”¤èµ·
âŒ æ¨¡å—é—´ä»æœ‰ä¾èµ–ï¼ˆåè®®ï¼‰
âŒ ä¸å¤Ÿçµæ´»

å®é™…é¡¹ç›®ï¼š
é€šå¸¸ç»“åˆä½¿ç”¨ï¼ŒURL-Based å¤„ç†å¤–éƒ¨å”¤èµ·å’Œç®€å•è·³è½¬ï¼Œ
Protocol-Based å¤„ç†å¤æ‚ä¸šåŠ¡è·³è½¬ã€‚
```

### 3. å¦‚ä½•è®¾è®¡ URL æ¨¡å¼ï¼Ÿ

```
1. éµå¾ª RESTful é£æ ¼
   âœ… app://user/:userId
   âœ… app://product/:productId/detail
   âŒ app://showUser?id=123

2. æ¸…æ™°çš„å±‚çº§ç»“æ„
   âœ… app://shop/product/:id
   âœ… app://shop/category/:categoryId/product/:id

3. ä¿ç•™å…³é”®å­—
   âœ… app://back
   âœ… app://dismiss
   âœ… app://home

4. ç‰ˆæœ¬æ§åˆ¶ï¼ˆå¯é€‰ï¼‰
   âœ… app://v1/user/:userId
   âœ… app://v2/user/:userId  // æ–°ç‰ˆæœ¬
```

### 4. æ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåºï¼Ÿ

```swift
// æŒ‰æ³¨å†Œé¡ºåºæ‰§è¡Œ
Router.shared.addInterceptor(interceptor1)  // å…ˆæ‰§è¡Œ
Router.shared.addInterceptor(interceptor2)  // åæ‰§è¡Œ

// ä»»ä½•ä¸€ä¸ªè¿”å› falseï¼Œç»ˆæ­¢åç»­æ‰§è¡Œ
interceptor1 â†’ true  â†’ ç»§ç»­
interceptor2 â†’ false â†’ ç»ˆæ­¢ï¼Œä¸è·³è½¬
interceptor3 â†’ ï¼ˆä¸æ‰§è¡Œï¼‰

// å¸¸è§é¡ºåºï¼š
1. å‚æ•°æ ¡éªŒ
2. æƒé™æ£€æŸ¥
3. ç™»å½•éªŒè¯
4. åŸ‹ç‚¹ç»Ÿè®¡
```

### 5. å¦‚ä½•å¤„ç†å‚æ•°ä¼ é€’ï¼Ÿ

```swift
// ç®€å•å‚æ•°ï¼šé€šè¿‡ URL
Router.shared.open("app://user/123?name=å¼ ä¸‰")

// å¤æ‚å¯¹è±¡ï¼šé€šè¿‡ parameters
let user = User(...)
Router.shared.open("app://user/123", parameters: ["user": user])

// ç›®æ ‡é¡µé¢ï¼š
class UserDetailViewController: UIViewController, Routable {
    static func instantiate(with parameters: [String: Any]) -> Self? {
        let vc = Self()
        vc.userId = parameters["userId"] as? String
        vc.user = parameters["user"] as? User  // å¤æ‚å¯¹è±¡
        return vc
    }
}

// æ³¨æ„äº‹é¡¹ï¼š
// âš ï¸ å¤–éƒ¨ URL åªèƒ½ä¼ é€’åŸºæœ¬ç±»å‹ï¼ˆString, Int, Boolï¼‰
// âš ï¸ å¤æ‚å¯¹è±¡åªèƒ½åœ¨ App å†…éƒ¨ä¼ é€’
```

### 6. å¦‚ä½•æµ‹è¯•è·¯ç”±ï¼Ÿ

```swift
// å•å…ƒæµ‹è¯•
func testRouteMatching() {
    let router = Router.shared
    router.register("app://user/:userId", viewControllerType: UserDetailViewController.self)
    
    // æµ‹è¯•åŒ¹é…
    let result = router.open("app://user/123")
    XCTAssertTrue(result)
}

// UI æµ‹è¯•
func testUserDetailNavigation() {
    let app = XCUIApplication()
    app.buttons["æ‰“å¼€ç”¨æˆ·è¯¦æƒ…"].tap()
    
    // éªŒè¯é¡µé¢è·³è½¬
    XCTAssertTrue(app.navigationBars["ç”¨æˆ·è¯¦æƒ…"].exists)
}
```

---

## ğŸš€ æ‰©å±•æ–¹å‘

### çŸ­æœŸæ‰©å±•

1. **è·¯ç”±è¡¨é…ç½®åŒ–**
   ```swift
   // ä» JSON æ–‡ä»¶æˆ–æœåŠ¡å™¨åŠ è½½è·¯ç”±è¡¨
   {
     "routes": [
       {
         "pattern": "app://user/:userId",
         "class": "UserDetailViewController",
         "action": "push"
       }
     ]
   }
   ```

2. **è·¯ç”±åˆ«å**
   ```swift
   router.registerAlias("userDetail", for: "app://user/:userId")
   router.open(alias: "userDetail", parameters: ["userId": "123"])
   ```

3. **è·¯ç”±æ—¥å¿—**
   ```swift
   // è®°å½•æ‰€æœ‰è·¯ç”±è·³è½¬
   router.enableLogging()
   ```

### ä¸­æœŸæ‰©å±•

4. **è·¯ç”±åŠ¨ç”»**
   ```swift
   router.register("app://user/:userId", transition: .custom {
       // è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»
   })
   ```

5. **è·¯ç”±å›è°ƒ**
   ```swift
   // é¡µé¢è¿”å›æ—¶å›è°ƒ
   router.open("app://edit", onDismiss: { result in
       print("ç¼–è¾‘å®Œæˆï¼š\(result)")
   })
   ```

6. **è·¯ç”±ä¼˜å…ˆçº§**
   ```swift
   // åŒä¸€ä¸ª URLï¼Œæ³¨å†Œå¤šä¸ªå¤„ç†å™¨ï¼ŒæŒ‰ä¼˜å…ˆçº§æ‰§è¡Œ
   router.register("app://share", priority: .high) { ... }
   router.register("app://share", priority: .low) { ... }
   ```

### é•¿æœŸæ‰©å±•

7. **è·¨å¹³å°è·¯ç”±**
   ```swift
   // ç»Ÿä¸€ iOS/Android è·¯ç”±è§„åˆ™
   // H5 ä¹Ÿå¯ä»¥é€šè¿‡ç›¸åŒ URL è·³è½¬
   ```

8. **A/B æµ‹è¯•**
   ```swift
   // æ ¹æ®å®éªŒåˆ†ç»„ï¼Œè·³è½¬åˆ°ä¸åŒé¡µé¢
   router.register("app://user/:userId") { parameters in
       if ABTest.group == "A" {
           return UserDetailViewControllerA()
       } else {
           return UserDetailViewControllerB()
       }
   }
   ```

---

## ğŸ’¡ æ€»ç»“

### å®ç°çš„åŠŸèƒ½

âœ… URL æ¨¡å¼åŒ¹é…ï¼ˆæ”¯æŒå ä½ç¬¦ï¼‰  
âœ… å¤šç§è·³è½¬æ–¹å¼ï¼ˆpush/present/replace/customï¼‰  
âœ… å‚æ•°ä¼ é€’ï¼ˆè·¯å¾„/Query/ä»£ç ï¼‰  
âœ… æ‹¦æˆªå™¨ï¼ˆä¸­é—´ä»¶ï¼‰  
âœ… Routable åè®®  
âœ… åŠ¨æ€æ³¨å†Œå’Œæ³¨é”€  
âœ… è·å–å½“å‰ ViewController  
âœ… UIViewController æ‰©å±•  

### æŠ€æœ¯äº®ç‚¹

â­ å®Œæ•´çš„è·¯ç”±æ¶æ„è®¾è®¡  
â­ æ”¯æŒå¤–éƒ¨ URL å”¤èµ·  
â­ æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç†  
â­ Routable åè®®è§£è€¦  
â­ çµæ´»çš„æ‰©å±•æ€§  

### é¢è¯•ä»·å€¼

ğŸ¯ å±•ç¤ºæ¶æ„è®¾è®¡èƒ½åŠ›  
ğŸ¯ ç†è§£è§£è€¦å’Œæ¨¡å—åŒ–  
ğŸ¯ æŒæ¡åè®®ç¼–ç¨‹  
ğŸ¯ äº†è§£ç»„ä»¶åŒ–æ–¹æ¡ˆ  
ğŸ¯ å®è·µè®¾è®¡æ¨¡å¼  

---

**è·¯ç”±æ¡†æ¶æ˜¯ç»„ä»¶åŒ–æ¶æ„çš„æ ¸å¿ƒï¼ğŸš€**

