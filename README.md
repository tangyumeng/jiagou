# iOS å¤šä»»åŠ¡ä¸‹è½½å™¨

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„iOSå¤šä»»åŠ¡ä¸‹è½½å™¨å®ç°ï¼Œå±•ç¤ºäº†è‰¯å¥½çš„æ¶æ„è®¾è®¡å’Œå·¥ç¨‹å®è·µã€‚

## åŠŸèƒ½ç‰¹æ€§

### âœ¨ æ ¸å¿ƒåŠŸèƒ½
- âœ… **å¤šä»»åŠ¡å¹¶å‘ä¸‹è½½** - æ”¯æŒæœ€å¤š3ä¸ªä»»åŠ¡åŒæ—¶ä¸‹è½½ï¼Œå…¶ä»–ä»»åŠ¡è‡ªåŠ¨æ’é˜Ÿ
- âœ… **æ–­ç‚¹ç»­ä¼ ** - æ”¯æŒæš‚åœåç»§ç»­ä¸‹è½½ï¼Œä¸æµªè´¹å·²ä¸‹è½½çš„æ•°æ®
- âœ… **åå°ä¸‹è½½** - Appé€€åˆ°åå°ä¹Ÿèƒ½ç»§ç»­ä¸‹è½½
- âœ… **å®æ—¶è¿›åº¦** - æ˜¾ç¤ºä¸‹è½½è¿›åº¦ã€é€Ÿåº¦ã€æ–‡ä»¶å¤§å°
- âœ… **ä»»åŠ¡ç®¡ç†** - æ”¯æŒæš‚åœã€ç»§ç»­ã€å–æ¶ˆã€åˆ é™¤æ“ä½œ
- âœ… **çŠ¶æ€ç®¡ç†** - æ¸…æ™°çš„ä»»åŠ¡çŠ¶æ€ï¼šç­‰å¾…ã€ä¸‹è½½ä¸­ã€å·²æš‚åœã€å·²å®Œæˆã€å¤±è´¥ã€å·²å–æ¶ˆ
- âœ… **çº¿ç¨‹å®‰å…¨** - ä½¿ç”¨GCDä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®å®‰å…¨

### ğŸ¯ ç”¨æˆ·ä½“éªŒ
- ç›´è§‚çš„UIç•Œé¢
- æµç•…çš„æ“ä½œä½“éªŒ
- å®Œæˆ/å¤±è´¥æç¤º
- æ»‘åŠ¨åˆ é™¤ä»»åŠ¡
- ä¸€é”®æ¸…é™¤å·²å®Œæˆä»»åŠ¡

## é¡¹ç›®ç»“æ„

```
jiagou/
â”œâ”€â”€ DownloadTask.swift          # ä¸‹è½½ä»»åŠ¡æ¨¡å‹
â”œâ”€â”€ DownloadManager.swift       # ä¸‹è½½ç®¡ç†å™¨ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ DownloadTaskCell.swift      # ä»»åŠ¡åˆ—è¡¨Cell
â”œâ”€â”€ ViewController.swift        # ä¸»ç•Œé¢æ§åˆ¶å™¨
â”œâ”€â”€ AppDelegate.swift           # Appå…¥å£
â””â”€â”€ SceneDelegate.swift         # åœºæ™¯ç®¡ç†
```

## æŠ€æœ¯æ¶æ„

### æ¶æ„æ¨¡å¼
é‡‡ç”¨**åˆ†å±‚æ¶æ„**è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     è¡¨ç¤ºå±‚ (UI Layer)        â”‚
â”‚  ViewController + Cell       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸šåŠ¡å±‚ (Business Layer)    â”‚
â”‚     DownloadManager          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ¨¡å‹å±‚ (Model Layer)       â”‚
â”‚       DownloadTask           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¾è®¡æ¨¡å¼
- **å•ä¾‹æ¨¡å¼** - DownloadManagerå…¨å±€å”¯ä¸€å®ä¾‹
- **è§‚å¯Ÿè€…æ¨¡å¼** - ä»»åŠ¡çŠ¶æ€å˜åŒ–è‡ªåŠ¨é€šçŸ¥
- **ä»£ç†æ¨¡å¼** - Managerä¸ViewControlleré€šä¿¡
- **çŠ¶æ€æ¨¡å¼** - æ¸…æ™°çš„ä»»åŠ¡çŠ¶æ€ç®¡ç†

### æ ¸å¿ƒæŠ€æœ¯
- `URLSession` - ç½‘ç»œä¸‹è½½
- `URLSessionDownloadDelegate` - ä¸‹è½½å›è°ƒ
- `DispatchQueue` - çº¿ç¨‹å®‰å…¨
- `Auto Layout` - çº¯ä»£ç UIå¸ƒå±€

## ä½¿ç”¨æ–¹æ³•

### è¿è¡Œé¡¹ç›®
1. å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®
2. ä½¿ç”¨ Xcode æ‰“å¼€ `jiagou.xcodeproj`
3. é€‰æ‹©æ¨¡æ‹Ÿå™¨æˆ–çœŸæœº
4. ç‚¹å‡»è¿è¡Œ (âŒ˜R)

### æ·»åŠ ä¸‹è½½ä»»åŠ¡
1. ç‚¹å‡»å³ä¸Šè§’çš„ `+` æŒ‰é’®
2. é€‰æ‹©æµ‹è¯•æ–‡ä»¶æˆ–è¾“å…¥è‡ªå®šä¹‰URL
3. ä»»åŠ¡è‡ªåŠ¨å¼€å§‹ä¸‹è½½

### ä»»åŠ¡æ“ä½œ
- **æš‚åœ**: ç‚¹å‡»ä»»åŠ¡å³ä¾§çš„"æš‚åœ"æŒ‰é’®
- **ç»§ç»­**: æš‚åœåå¯ä»¥ç‚¹å‡»"ç»§ç»­"æŒ‰é’®
- **åˆ é™¤**: å·¦æ»‘ä»»åŠ¡ï¼Œç‚¹å‡»"åˆ é™¤"
- **æ¸…é™¤å·²å®Œæˆ**: ç‚¹å‡»å·¦ä¸Šè§’"æ¸…é™¤å·²å®Œæˆ"æŒ‰é’®

## ä»£ç ç¤ºä¾‹

### 1. æ·»åŠ ä¸‹è½½ä»»åŠ¡
```swift
let url = URL(string: "https://example.com/file.zip")!
let task = DownloadManager.shared.addTask(url: url, fileName: "myfile.zip")
DownloadManager.shared.startDownload(taskId: task.id)
```

### 2. ç›‘å¬ä¸‹è½½è¿›åº¦
```swift
task.onProgressChanged = { task in
    print("è¿›åº¦: \(task.progress * 100)%")
    print("é€Ÿåº¦: \(task.formattedSpeed())")
}

task.onStateChanged = { task in
    print("çŠ¶æ€: \(task.stateDescription())")
}
```

### 3. æ§åˆ¶ä¸‹è½½
```swift
// æš‚åœ
DownloadManager.shared.pauseDownload(taskId: task.id)

// ç»§ç»­
DownloadManager.shared.startDownload(taskId: task.id)

// å–æ¶ˆ
DownloadManager.shared.cancelDownload(taskId: task.id)

// åˆ é™¤
DownloadManager.shared.removeTask(taskId: task.id)
```

### 4. å®ç°ä»£ç†
```swift
extension YourViewController: DownloadManagerDelegate {
    func downloadManager(_ manager: DownloadManager, didCompleteTask task: DownloadTask) {
        print("âœ… ä¸‹è½½å®Œæˆ: \(task.fileName)")
    }
    
    func downloadManager(_ manager: DownloadManager, didFailTask task: DownloadTask, withError error: Error) {
        print("âŒ ä¸‹è½½å¤±è´¥: \(error.localizedDescription)")
    }
    
    func downloadManager(_ manager: DownloadManager, didUpdateTask task: DownloadTask) {
        // æ›´æ–°UI
    }
}
```

## é…ç½®è¯´æ˜

### ä¿®æ”¹æœ€å¤§å¹¶å‘æ•°
åœ¨ `DownloadManager.swift` ä¸­ä¿®æ”¹ï¼š
```swift
private let maxConcurrentDownloads = 3  // æ”¹ä¸ºä½ æƒ³è¦çš„æ•°é‡
```

### ä¿®æ”¹ä¸‹è½½ç›®å½•
åœ¨ `DownloadManager.swift` ä¸­ä¿®æ”¹ï¼š
```swift
private lazy var downloadDirectory: URL = {
    let paths = fileManager.urls(for: .documentDirectory, in: .userDomainMask)
    let documentsDirectory = paths[0]
    return documentsDirectory.appendingPathComponent("Downloads")
}()
```

### æ·»åŠ è‡ªå®šä¹‰æµ‹è¯•URL
åœ¨ `ViewController.swift` ä¸­ä¿®æ”¹ï¼š
```swift
private let testURLs = [
    "https://your-url-1.com/file1.zip",
    "https://your-url-2.com/file2.pdf",
    // ... æ·»åŠ æ›´å¤š
]
```

## æ–‡ä»¶è¯´æ˜

### DownloadTask.swift
ä¸‹è½½ä»»åŠ¡æ¨¡å‹ï¼ŒåŒ…å«ï¼š
- ä»»åŠ¡å±æ€§ï¼ˆURLã€çŠ¶æ€ã€è¿›åº¦ç­‰ï¼‰
- è¿›åº¦è®¡ç®—å’Œé€Ÿåº¦è®¡ç®—
- è§‚å¯Ÿè€…å›è°ƒæœºåˆ¶
- æ ¼å¼åŒ–å·¥å…·æ–¹æ³•

### DownloadManager.swift
ä¸‹è½½ç®¡ç†å™¨ï¼Œè´Ÿè´£ï¼š
- ä»»åŠ¡çš„å¢åˆ æ”¹æŸ¥
- å¹¶å‘æ§åˆ¶å’Œé˜Ÿåˆ—è°ƒåº¦
- URLSessionç®¡ç†
- æ–‡ä»¶æ“ä½œ
- çº¿ç¨‹å®‰å…¨ä¿éšœ

### DownloadTaskCell.swift
è‡ªå®šä¹‰TableViewCellï¼Œæ˜¾ç¤ºï¼š
- æ–‡ä»¶å
- ä¸‹è½½çŠ¶æ€
- è¿›åº¦æ¡å’Œç™¾åˆ†æ¯”
- ä¸‹è½½é€Ÿåº¦
- æ“ä½œæŒ‰é’®

### ViewController.swift
ä¸»ç•Œé¢æ§åˆ¶å™¨ï¼Œå®ç°ï¼š
- UIå¸ƒå±€å’Œäº¤äº’
- ä»»åŠ¡åˆ—è¡¨ç®¡ç†
- ä»£ç†å›è°ƒå¤„ç†
- ç”¨æˆ·æ“ä½œå“åº”

## é«˜çº§ç‰¹æ€§

### 1. çº¿ç¨‹å®‰å…¨
ä½¿ç”¨å¹¶å‘é˜Ÿåˆ—ä¿æŠ¤å…±äº«æ•°æ®ï¼š
```swift
private let taskQueue = DispatchQueue(
    label: "com.jiagou.downloadmanager", 
    attributes: .concurrent
)

// è¯»æ“ä½œ
taskQueue.sync { ... }

// å†™æ“ä½œ
taskQueue.async(flags: .barrier) { ... }
```

### 2. å†…å­˜ç®¡ç†
é¿å…å¾ªç¯å¼•ç”¨ï¼š
```swift
task.onProgressChanged = { [weak self] task in
    self?.updateUI(task)
}
```

### 3. ä¸»çº¿ç¨‹æ›´æ–°UI
æ‰€æœ‰UIæ›´æ–°éƒ½åœ¨ä¸»çº¿ç¨‹ï¼š
```swift
DispatchQueue.main.async {
    // æ›´æ–°UI
}
```

## æµ‹è¯•æ–‡ä»¶

é¡¹ç›®å†…ç½®äº†å‡ ä¸ªæµ‹è¯•ä¸‹è½½URLï¼š
- 100MBæµ‹è¯•æ–‡ä»¶
- 1GBå¤§æ–‡ä»¶
- è§†é¢‘æ–‡ä»¶ï¼ˆMP4ï¼‰

è¿™äº›æ–‡ä»¶æ¥è‡ªå¯é çš„æµ‹è¯•æœåŠ¡å™¨ï¼Œå¯ä»¥å®‰å…¨ä¸‹è½½ã€‚

## æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œæƒé™**
   - ç¡®ä¿åœ¨ Info.plist ä¸­é…ç½®äº†ç½‘ç»œè®¿é—®æƒé™
   - å¦‚éœ€è®¿é—®HTTPï¼ˆéHTTPSï¼‰åœ°å€ï¼Œéœ€é…ç½® App Transport Security

2. **å­˜å‚¨ç©ºé—´**
   - ä¸‹è½½å¤§æ–‡ä»¶å‰ç¡®ä¿è®¾å¤‡æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´
   - æ–‡ä»¶ä¿å­˜åœ¨ Documents/Downloads ç›®å½•

3. **åå°ä¸‹è½½é™åˆ¶**
   - åå°ä¸‹è½½å—ç³»ç»Ÿé™åˆ¶ï¼Œä¸æ˜¯æ— é™åˆ¶çš„
   - ç³»ç»Ÿå¯èƒ½ä¼šæ ¹æ®ç”µé‡ã€ç½‘ç»œç­‰æ¡ä»¶æš‚åœä¸‹è½½

4. **çœŸæœºæµ‹è¯•**
   - éƒ¨åˆ†åŠŸèƒ½åœ¨çœŸæœºä¸Šè¡¨ç°æ›´å¥½
   - åå°ä¸‹è½½å»ºè®®åœ¨çœŸæœºä¸Šæµ‹è¯•

## æ‰©å±•å»ºè®®

### å¯ä»¥æ·»åŠ çš„åŠŸèƒ½
- [ ] ä»»åŠ¡æŒä¹…åŒ–ï¼ˆCoreData / Realmï¼‰
- [ ] ä¸‹è½½å†å²è®°å½•
- [ ] ä¸‹è½½ä¼˜å…ˆçº§è®¾ç½®
- [ ] WiFi Onlyæ¨¡å¼
- [ ] æµé‡ç»Ÿè®¡
- [ ] ä¸‹è½½åˆ†ç±»å’Œæ–‡ä»¶ç®¡ç†
- [ ] æœç´¢å’Œç­›é€‰åŠŸèƒ½
- [ ] åˆ†äº«å·²ä¸‹è½½æ–‡ä»¶
- [ ] ä¸‹è½½é˜Ÿåˆ—å¯¼å…¥å¯¼å‡º

### ä¼˜åŒ–æ–¹å‘
- [ ] ä½¿ç”¨ Combine / RxSwift ç®€åŒ–å¼‚æ­¥æ“ä½œ
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•
- [ ] æ€§èƒ½ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ
- [ ] æ”¯æŒ SwiftUI
- [ ] å¤šè¯­è¨€å›½é™…åŒ–
- [ ] æ·±è‰²æ¨¡å¼é€‚é…ä¼˜åŒ–

## æ¶æ„åˆ†æ

è¯¦ç»†çš„æ¶æ„åˆ†æè¯·æŸ¥çœ‹ [æ¶æ„åˆ†æ.md](./æ¶æ„åˆ†æ.md)ï¼ŒåŒ…å«ï¼š
- æ•´ä½“æ¶æ„è®¾è®¡
- è®¾è®¡æ¨¡å¼è¯¦è§£
- æŠ€æœ¯å®ç°åŸç†
- æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- æ”¹è¿›æ–¹å‘å»ºè®®

## ç³»ç»Ÿè¦æ±‚

- iOS 13.0+
- Xcode 12.0+
- Swift 5.0+

## å¼€æºåè®®

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å‚è€ƒä½¿ç”¨ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿è®¨è®ºäº¤æµã€‚

---

**Enjoy Coding! ğŸš€**

