# è·¯ç”±ä¼ é€’å¤æ‚å¯¹è±¡æ–¹æ¡ˆ

## ğŸ“Œ é—®é¢˜èƒŒæ™¯

**é—®é¢˜ï¼š** "Route æ€æ ·ä¼ å¤æ‚å¯¹è±¡ï¼Œæ¯”å¦‚ UIImageã€NSData ç­‰ç±»å‹æ•°æ®"

### æ ¸å¿ƒé™åˆ¶

```
URL-Based è·¯ç”±çš„é™åˆ¶ï¼š
âŒ URL åªèƒ½åŒ…å«å­—ç¬¦ä¸²
âŒ Query å‚æ•°åªèƒ½æ˜¯ String ç±»å‹
âŒ æ— æ³•ç›´æ¥ä¼ é€’å¯¹è±¡å¼•ç”¨

éœ€è¦è§£å†³ï¼š
âœ… å¦‚ä½•ä¼ é€’ UIImageï¼Ÿ
âœ… å¦‚ä½•ä¼ é€’ NSDataï¼Ÿ
âœ… å¦‚ä½•ä¼ é€’è‡ªå®šä¹‰å¯¹è±¡ï¼Ÿ
âœ… å¦‚ä½•ä¼ é€’é—­åŒ…ï¼Ÿ
```

---

## ğŸ¯ è§£å†³æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆå¯¹æ¯”è¡¨

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **1. parameters å­—å…¸** | âœ… ç®€å•ç›´æ¥<br>âœ… ç±»å‹å®‰å…¨<br>âœ… æ— éœ€åºåˆ—åŒ– | âŒ ä»…é™å†…éƒ¨è·¯ç”±<br>âŒ ä¸æ”¯æŒå¤–éƒ¨å”¤èµ· | åº”ç”¨å†…è·³è½¬ |
| **2. å…¨å±€ç¼“å­˜** | âœ… æ”¯æŒå¤–éƒ¨å”¤èµ·<br>âœ… URL ç®€æ´ | âŒ éœ€è¦ç®¡ç†ç”Ÿå‘½å‘¨æœŸ<br>âŒ å†…å­˜å ç”¨ | å¤§å¯¹è±¡ä¼ é€’ |
| **3. å•ä¾‹/Manager** | âœ… ç»Ÿä¸€ç®¡ç†<br>âœ… å¯æŒä¹…åŒ– | âŒ å…¨å±€çŠ¶æ€<br>âŒ è€¦åˆæ€§ | å…±äº«æ•°æ® |
| **4. åºåˆ—åŒ–** | âœ… æ”¯æŒå¤–éƒ¨å”¤èµ·<br>âœ… å¯æŒä¹…åŒ– | âŒ URL è¿‡é•¿<br>âŒ æ€§èƒ½å¼€é”€ | å°å¯¹è±¡ï¼Œå¤–éƒ¨å”¤èµ· |

---

## ğŸ’» æ–¹æ¡ˆ 1ï¼šé€šè¿‡ parameters å­—å…¸ä¼ é€’ï¼ˆæ¨èâ­ï¼‰

### åŸç†

æˆ‘ä»¬çš„ Router å·²ç»æ”¯æŒ `parameters` å‚æ•°ï¼Œå¯ä»¥ä¼ é€’ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼

```swift
func open(
    _ urlString: String,
    parameters: [String: Any] = [:],  // â† è¿™é‡Œå¯ä»¥ä¼ é€’ä»»æ„å¯¹è±¡
    from source: UIViewController? = nil,
    animated: Bool = true,
    completion: (() -> Void)? = nil
) -> Bool
```

### å®ç°ç¤ºä¾‹

#### 1. æ³¨å†Œè·¯ç”±

```swift
// åœ¨ AppDelegate ä¸­æ³¨å†Œ
router.register("app://image-preview", viewControllerType: ImagePreviewViewController.self)
```

#### 2. åˆ›å»ºæ¥æ”¶å¤æ‚å¯¹è±¡çš„ ViewController

```swift
class ImagePreviewViewController: UIViewController, Routable {
    
    // æ¥æ”¶å¤æ‚å¯¹è±¡
    var image: UIImage?
    var imageData: NSData?
    var customObject: CustomModel?
    var completion: (() -> Void)?
    
    static func instantiate(with parameters: [String : Any]) -> Self? {
        let vc = Self()
        
        // ä» parameters ä¸­æå–å¤æ‚å¯¹è±¡
        vc.image = parameters["image"] as? UIImage
        vc.imageData = parameters["imageData"] as? NSData
        vc.customObject = parameters["customObject"] as? CustomModel
        vc.completion = parameters["completion"] as? (() -> Void)
        
        return vc
    }
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        title = "å›¾ç‰‡é¢„è§ˆ"
        view.backgroundColor = .systemBackground
        
        // ä½¿ç”¨ä¼ é€’çš„å¯¹è±¡
        if let image = image {
            let imageView = UIImageView(image: image)
            imageView.contentMode = .scaleAspectFit
            // ... è®¾ç½®çº¦æŸ
        }
    }
}
```

#### 3. ä¼ é€’å¤æ‚å¯¹è±¡

```swift
// åˆ›å»ºå¤æ‚å¯¹è±¡
let image = UIImage(named: "test")!
let imageData = image.pngData()! as NSData
let customObject = CustomModel(name: "æµ‹è¯•", value: 100)

// é€šè¿‡ parameters ä¼ é€’
Router.shared.open(
    "app://image-preview",
    parameters: [
        "image": image,              // UIImage
        "imageData": imageData,      // NSData
        "customObject": customObject, // è‡ªå®šä¹‰å¯¹è±¡
        "completion": {              // é—­åŒ…
            print("é¡µé¢å·²å…³é—­")
        }
    ]
)
```

### ä¼˜ç‚¹

âœ… **ç±»å‹å®‰å…¨** - ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹  
âœ… **æ— éœ€åºåˆ—åŒ–** - ç›´æ¥ä¼ é€’å¯¹è±¡å¼•ç”¨  
âœ… **æ”¯æŒä»»æ„ç±»å‹** - UIImageã€NSDataã€é—­åŒ…ç­‰  
âœ… **æ€§èƒ½å¥½** - æ— é¢å¤–å¼€é”€  
âœ… **ä»£ç ç®€æ´** - ä¸€è¡Œä»£ç å®Œæˆ  

### ç¼ºç‚¹

âŒ **ä»…é™å†…éƒ¨** - åªèƒ½åº”ç”¨å†…è·³è½¬  
âŒ **ä¸æ”¯æŒå¤–éƒ¨å”¤èµ·** - æ— æ³•é€šè¿‡ URL Scheme ä¼ é€’  
âŒ **ä¸æ”¯æŒé€šçŸ¥** - æ¨é€é€šçŸ¥æ— æ³•ä¼ é€’å¯¹è±¡  

### é€‚ç”¨åœºæ™¯

âœ… åº”ç”¨å†…é¡µé¢è·³è½¬  
âœ… é¢„è§ˆå›¾ç‰‡ã€è§†é¢‘  
âœ… ä¼ é€’é€‰ä¸­çš„æ•°æ®æ¨¡å‹  
âœ… ä¼ é€’å›è°ƒé—­åŒ…  

---

## ğŸ’» æ–¹æ¡ˆ 2ï¼šå…¨å±€ç¼“å­˜ + ID ä¼ é€’

### åŸç†

```
1. å°†å¤æ‚å¯¹è±¡å­˜å‚¨åˆ°å…¨å±€ç¼“å­˜
2. ç”Ÿæˆå”¯ä¸€ ID
3. URL ä¸­åªä¼ é€’ ID
4. ç›®æ ‡é¡µé¢é€šè¿‡ ID è·å–å¯¹è±¡
5. ä½¿ç”¨åä»ç¼“å­˜ä¸­ç§»é™¤
```

### å®ç°ä»£ç 

#### 1. åˆ›å»ºå…¨å±€ç¼“å­˜ç®¡ç†å™¨

```swift
// RouteDataCache.swift

class RouteDataCache {
    
    // MARK: - å•ä¾‹
    static let shared = RouteDataCache()
    
    // MARK: - ç¼“å­˜å­˜å‚¨
    private var cache: [String: Any] = [:]
    private let queue = DispatchQueue(label: "com.router.datacache", attributes: .concurrent)
    
    private init() {}
    
    // MARK: - å­˜å‚¨å¯¹è±¡
    
    /// å­˜å‚¨å¯¹è±¡å¹¶è¿”å› ID
    func store<T>(_ object: T) -> String {
        let id = UUID().uuidString
        queue.async(flags: .barrier) { [weak self] in
            self?.cache[id] = object
        }
        return id
    }
    
    // MARK: - è·å–å¯¹è±¡
    
    /// è·å–å¯¹è±¡ï¼ˆä¸ç§»é™¤ï¼‰
    func get<T>(_ id: String) -> T? {
        var result: T?
        queue.sync {
            result = cache[id] as? T
        }
        return result
    }
    
    /// è·å–å¯¹è±¡å¹¶ç§»é™¤
    func fetch<T>(_ id: String) -> T? {
        var result: T?
        queue.sync(flags: .barrier) { [weak self] in
            result = self?.cache[id] as? T
            self?.cache.removeValue(forKey: id)
        }
        return result
    }
    
    // MARK: - ç§»é™¤å¯¹è±¡
    
    /// ç§»é™¤æŒ‡å®šå¯¹è±¡
    func remove(_ id: String) {
        queue.async(flags: .barrier) { [weak self] in
            self?.cache.removeValue(forKey: id)
        }
    }
    
    /// æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
    func removeAll() {
        queue.async(flags: .barrier) { [weak self] in
            self?.cache.removeAll()
        }
    }
    
    // MARK: - è°ƒè¯•
    
    var cacheCount: Int {
        var count = 0
        queue.sync {
            count = cache.count
        }
        return count
    }
}
```

#### 2. ä½¿ç”¨ç¼“å­˜ä¼ é€’å¯¹è±¡

```swift
// å­˜å‚¨å¤æ‚å¯¹è±¡
let image = UIImage(named: "test")!
let imageId = RouteDataCache.shared.store(image)

// URL ä¸­åªä¼ é€’ ID
Router.shared.open("app://image-preview/\(imageId)")
```

#### 3. ç›®æ ‡é¡µé¢è·å–å¯¹è±¡

```swift
class ImagePreviewViewController: UIViewController, Routable {
    
    var imageId: String?
    var image: UIImage?
    
    static func instantiate(with parameters: [String : Any]) -> Self? {
        let vc = Self()
        vc.imageId = parameters["imageId"] as? String
        return vc
    }
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        // ä»ç¼“å­˜ä¸­è·å–å¯¹è±¡ï¼ˆå¹¶ç§»é™¤ï¼‰
        if let imageId = imageId,
           let image: UIImage = RouteDataCache.shared.fetch(imageId) {
            self.image = image
            print("âœ… æˆåŠŸè·å–å›¾ç‰‡ï¼š\(image.size)")
        }
    }
}
```

### ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### è‡ªåŠ¨æ¸…ç†ç­–ç•¥

```swift
class RouteDataCache {
    
    // æ·»åŠ æ—¶é—´æˆ³
    private struct CacheItem {
        let object: Any
        let timestamp: Date
    }
    
    private var cache: [String: CacheItem] = [:]
    
    // å­˜å‚¨æ—¶è®°å½•æ—¶é—´
    func store<T>(_ object: T, ttl: TimeInterval = 300) -> String {
        let id = UUID().uuidString
        let item = CacheItem(object: object, timestamp: Date())
        queue.async(flags: .barrier) { [weak self] in
            self?.cache[id] = item
        }
        
        // è‡ªåŠ¨æ¸…ç†ï¼ˆ5åˆ†é’Ÿåï¼‰
        DispatchQueue.global().asyncAfter(deadline: .now() + ttl) { [weak self] in
            self?.remove(id)
        }
        
        return id
    }
}
```

### ä¼˜ç‚¹

âœ… **æ”¯æŒå¤–éƒ¨å”¤èµ·** - URL ä¸­åªæœ‰ ID  
âœ… **URL ç®€æ´** - ä¸ä¼šè¿‡é•¿  
âœ… **æ”¯æŒå¤§å¯¹è±¡** - å›¾ç‰‡ã€è§†é¢‘ç­‰  
âœ… **æ”¯æŒé€šçŸ¥** - å¯åœ¨é€šçŸ¥ä¸­ä¼ é€’ ID  

### ç¼ºç‚¹

âŒ **éœ€è¦ç®¡ç†ç”Ÿå‘½å‘¨æœŸ** - é˜²æ­¢å†…å­˜æ³„æ¼  
âŒ **çº¿ç¨‹å®‰å…¨** - éœ€è¦åŠ é”  
âŒ **å†…å­˜å ç”¨** - å¤§å¯¹è±¡å ç”¨å†…å­˜  

### é€‚ç”¨åœºæ™¯

âœ… ä»é€šçŸ¥è·³è½¬ï¼ˆæå‰ç¼“å­˜æ•°æ®ï¼‰  
âœ… å¤–éƒ¨ URL å”¤èµ·ï¼ˆæå‰å‡†å¤‡æ•°æ®ï¼‰  
âœ… ä¼ é€’å¤§å¯¹è±¡ï¼ˆå›¾ç‰‡ã€è§†é¢‘ï¼‰  
âœ… è·¨æ¨¡å—æ•°æ®ä¼ é€’  

---

## ğŸ’» æ–¹æ¡ˆ 3ï¼šå•ä¾‹/Manager ç®¡ç†

### åŸç†

```
ä½¿ç”¨å•ä¾‹æˆ– Manager ç±»å­˜å‚¨å…±äº«æ•°æ®
é¡µé¢é€šè¿‡å•ä¾‹è·å–æ•°æ®
é€‚åˆå…¨å±€å…±äº«çš„æ•°æ®
```

### å®ç°ç¤ºä¾‹

#### 1. åˆ›å»ºæ•°æ®ç®¡ç†å™¨

```swift
class SharedDataManager {
    static let shared = SharedDataManager()
    
    // å…±äº«æ•°æ®
    var currentImage: UIImage?
    var currentUser: User?
    var selectedItems: [Item] = []
    
    private init() {}
    
    // ä¾¿æ·æ–¹æ³•
    func setImage(_ image: UIImage) {
        currentImage = image
    }
    
    func getImage() -> UIImage? {
        let image = currentImage
        currentImage = nil  // è·å–åæ¸…é™¤
        return image
    }
}
```

#### 2. è®¾ç½®æ•°æ®å¹¶è·³è½¬

```swift
// è®¾ç½®å…±äº«æ•°æ®
let image = UIImage(named: "test")!
SharedDataManager.shared.setImage(image)

// è·³è½¬
Router.shared.open("app://image-preview")
```

#### 3. ç›®æ ‡é¡µé¢è·å–æ•°æ®

```swift
class ImagePreviewViewController: UIViewController {
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        // ä»å•ä¾‹è·å–æ•°æ®
        if let image = SharedDataManager.shared.getImage() {
            print("âœ… è·å–åˆ°å›¾ç‰‡")
            // ä½¿ç”¨å›¾ç‰‡
        }
    }
}
```

### ä¼˜ç‚¹

âœ… **å…¨å±€è®¿é—®** - ä»»ä½•åœ°æ–¹éƒ½èƒ½è·å–  
âœ… **ç»Ÿä¸€ç®¡ç†** - é›†ä¸­ç®¡ç†æ•°æ®  
âœ… **ç®€å•ç›´æ¥** - ä»£ç ç®€æ´  

### ç¼ºç‚¹

âŒ **å…¨å±€çŠ¶æ€** - éš¾ä»¥è¿½è¸ªæ•°æ®æµ  
âŒ **è€¦åˆæ€§é«˜** - ä¾èµ–å•ä¾‹  
âŒ **æµ‹è¯•å›°éš¾** - å…¨å±€çŠ¶æ€å½±å“æµ‹è¯•  

### é€‚ç”¨åœºæ™¯

âœ… ç”¨æˆ·ä¿¡æ¯ã€é…ç½®ç­‰å…¨å±€æ•°æ®  
âœ… ä¸´æ—¶å…±äº«æ•°æ®  
âœ… è´­ç‰©è½¦ã€é€‰ä¸­é¡¹ç­‰  

---

## ğŸ’» æ–¹æ¡ˆ 4ï¼šåºåˆ—åŒ–ä¼ é€’ï¼ˆä¸æ¨èï¼‰

### åŸç†

```
1. å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼ˆJSONã€Base64ï¼‰
2. æ”¾å…¥ URL Query å‚æ•°
3. ç›®æ ‡é¡µé¢ååºåˆ—åŒ–
```

### å®ç°ç¤ºä¾‹

```swift
// åºåˆ—åŒ–å¯¹è±¡
let model = CustomModel(name: "æµ‹è¯•", value: 100)
let jsonData = try! JSONEncoder().encode(model)
let base64String = jsonData.base64EncodedString()

// ä¼ é€’
Router.shared.open("app://detail?data=\(base64String)")

// ååºåˆ—åŒ–
if let dataString = parameters["data"] as? String,
   let data = Data(base64Encoded: dataString),
   let model = try? JSONDecoder().decode(CustomModel.self, from: data) {
    self.model = model
}
```

### ä¼˜ç‚¹

âœ… **æ”¯æŒå¤–éƒ¨å”¤èµ·**  
âœ… **å¯æŒä¹…åŒ–**  

### ç¼ºç‚¹

âŒ **URL è¿‡é•¿** - å¯èƒ½è¶…è¿‡é™åˆ¶  
âŒ **æ€§èƒ½å¼€é”€** - åºåˆ—åŒ–/ååºåˆ—åŒ–  
âŒ **ç±»å‹é™åˆ¶** - åªèƒ½ä¼ é€’ Codable å¯¹è±¡  
âŒ **æ— æ³•ä¼ é€’ UIImage** - å›¾ç‰‡å¤ªå¤§  

### é€‚ç”¨åœºæ™¯

âœ… å°å¯¹è±¡ï¼ˆ< 1KBï¼‰  
âœ… å¤–éƒ¨å”¤èµ·æ—¶ä¼ é€’å‚æ•°  
âœ… Universal Links  

---

## ğŸ¯ æ¨èæ–¹æ¡ˆé€‰æ‹©

### å†³ç­–æ ‘

```
éœ€è¦ä¼ é€’å¤æ‚å¯¹è±¡ï¼Ÿ
  â†“
åº”ç”¨å†…è·³è½¬ï¼Ÿ
  â†“ æ˜¯
  ä½¿ç”¨æ–¹æ¡ˆ1ï¼šparameters å­—å…¸ â­â­â­â­â­
  
  â†“ å¦ï¼ˆå¤–éƒ¨å”¤èµ·ï¼‰
  
å¯¹è±¡å¤§å°ï¼Ÿ
  â†“ å°ï¼ˆ< 1KBï¼‰
  ä½¿ç”¨æ–¹æ¡ˆ4ï¼šåºåˆ—åŒ– â­â­â­
  
  â†“ å¤§ï¼ˆå›¾ç‰‡ã€è§†é¢‘ï¼‰
  ä½¿ç”¨æ–¹æ¡ˆ2ï¼šå…¨å±€ç¼“å­˜ â­â­â­â­
```

### åœºæ™¯æ¨è

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|------|---------|------|
| é¢„è§ˆå›¾ç‰‡ | æ–¹æ¡ˆ1ï¼ˆparametersï¼‰ | ç®€å•ç›´æ¥ |
| ç¼–è¾‘æ•°æ® | æ–¹æ¡ˆ1ï¼ˆparametersï¼‰ | ç±»å‹å®‰å…¨ |
| ä¼ é€’å›è°ƒ | æ–¹æ¡ˆ1ï¼ˆparametersï¼‰ | å”¯ä¸€é€‰æ‹© |
| é€šçŸ¥è·³è½¬ | æ–¹æ¡ˆ2ï¼ˆç¼“å­˜ï¼‰ | æå‰å‡†å¤‡æ•°æ® |
| URL Scheme | æ–¹æ¡ˆ2ï¼ˆç¼“å­˜ï¼‰ | æ”¯æŒå¤æ‚å¯¹è±¡ |
| å…¨å±€æ•°æ® | æ–¹æ¡ˆ3ï¼ˆå•ä¾‹ï¼‰ | ç»Ÿä¸€ç®¡ç† |
| å°å¯¹è±¡å¤–éƒ¨å”¤èµ· | æ–¹æ¡ˆ4ï¼ˆåºåˆ—åŒ–ï¼‰ | æ”¯æŒå¤–éƒ¨ |

---

## ğŸ“Š å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šä¼ é€’å›¾ç‰‡ï¼ˆåº”ç”¨å†…ï¼‰

```swift
// æ–¹æ¡ˆ1ï¼šparameters å­—å…¸
let image = UIImage(named: "test")!

Router.shared.open(
    "app://image-preview",
    parameters: [
        "image": image,
        "title": "ç¾ä¸½çš„é£æ™¯"
    ]
)
```

### ç¤ºä¾‹ 2ï¼šä¼ é€’å›¾ç‰‡ï¼ˆä»é€šçŸ¥ï¼‰

```swift
// æ”¶åˆ°é€šçŸ¥æ—¶ï¼Œé¢„å…ˆç¼“å­˜å›¾ç‰‡
func didReceiveNotification(imageUrl: String) {
    // ä¸‹è½½å›¾ç‰‡
    downloadImage(imageUrl) { image in
        // å­˜å‚¨åˆ°ç¼“å­˜
        let imageId = RouteDataCache.shared.store(image)
        
        // å‘é€æœ¬åœ°é€šçŸ¥
        let content = UNMutableNotificationContent()
        content.userInfo = [
            "route": "app://image-preview/\(imageId)"
        ]
        // ...
    }
}

// ç‚¹å‡»é€šçŸ¥å
// è·¯ç”±è‡ªåŠ¨æå– imageId
// ImagePreviewViewController ä»ç¼“å­˜è·å–å›¾ç‰‡
```

### ç¤ºä¾‹ 3ï¼šä¼ é€’è‡ªå®šä¹‰å¯¹è±¡

```swift
struct Product: Codable {
    let id: Int
    let name: String
    let price: Double
    let image: UIImage  // âŒ ä¸èƒ½æ”¾åœ¨ Codable ä¸­
}

// æ­£ç¡®åšæ³•ï¼šåˆ†ç¦»æ•°æ®å’Œå›¾ç‰‡
let product = ProductData(id: 1, name: "iPhone", price: 5999)
let image = UIImage(named: "iphone")!

Router.shared.open(
    "app://product-detail",
    parameters: [
        "product": product,
        "image": image
    ]
)
```

### ç¤ºä¾‹ 4ï¼šä¼ é€’é—­åŒ…å›è°ƒ

```swift
// é€‰æ‹©å›¾ç‰‡åå›è°ƒ
Router.shared.open(
    "app://image-picker",
    parameters: [
        "onImageSelected": { (image: UIImage) in
            print("ç”¨æˆ·é€‰æ‹©äº†å›¾ç‰‡ï¼š\(image.size)")
            self.selectedImage = image
        }
    ]
)

// ImagePickerViewController
var onImageSelected: ((UIImage) -> Void)?

func imagePickerController(..., didFinishPickingMediaWithInfo info: ...) {
    if let image = info[.originalImage] as? UIImage {
        onImageSelected?(image)  // å›è°ƒ
        dismiss(animated: true)
    }
}
```

---

## ğŸ” æœ€ä½³å®è·µ

### 1. ä¼˜å…ˆä½¿ç”¨ parameters

```swift
âœ… æ¨èï¼š
Router.shared.open("app://detail", parameters: ["data": complexObject])

âŒ é¿å…ï¼š
let jsonString = serialize(complexObject)
Router.shared.open("app://detail?data=\(jsonString)")
```

### 2. å¤§å¯¹è±¡ä½¿ç”¨ç¼“å­˜

```swift
âœ… æ¨èï¼ˆå›¾ç‰‡ã€è§†é¢‘ï¼‰ï¼š
let id = RouteDataCache.shared.store(largeObject)
Router.shared.open("app://preview/\(id)")

âŒ é¿å…ï¼š
Router.shared.open("app://preview", parameters: ["large": largeObject])
// å¦‚æœå¯¹è±¡è¿‡å¤§ï¼Œä¼šå ç”¨å†…å­˜
```

### 3. åŠæ—¶æ¸…ç†ç¼“å­˜

```swift
// ä½¿ç”¨åç«‹å³æ¸…ç†
if let data = RouteDataCache.shared.fetch(id) {
    // fetch ä¼šè‡ªåŠ¨ç§»é™¤
    use(data)
}

// æˆ–åœ¨ deinit ä¸­æ¸…ç†
deinit {
    if let id = dataId {
        RouteDataCache.shared.remove(id)
    }
}
```

### 4. ç±»å‹å®‰å…¨

```swift
âœ… æ¨èï¼šä½¿ç”¨å…·ä½“ç±»å‹
var image: UIImage?
image = parameters["image"] as? UIImage

âŒ é¿å…ï¼šä½¿ç”¨ Any
var data: Any?
data = parameters["data"]  // ä¸çŸ¥é“æ˜¯ä»€ä¹ˆç±»å‹
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å†…å­˜ç®¡ç†

```swift
// âŒ å¯èƒ½å¯¼è‡´å¾ªç¯å¼•ç”¨
Router.shared.open("app://detail", parameters: [
    "completion": { self.doSomething() }  // æŒæœ‰ self
])

// âœ… ä½¿ç”¨ weak self
Router.shared.open("app://detail", parameters: [
    "completion": { [weak self] in self?.doSomething() }
])
```

### 2. çº¿ç¨‹å®‰å…¨

```swift
// ç¼“å­˜éœ€è¦çº¿ç¨‹å®‰å…¨
private let queue = DispatchQueue(label: "...", attributes: .concurrent)

func store() {
    queue.async(flags: .barrier) {
        // å†™æ“ä½œ
    }
}

func get() {
    queue.sync {
        // è¯»æ“ä½œ
    }
}
```

### 3. ç”Ÿå‘½å‘¨æœŸ

```swift
// ç¼“å­˜å¯¹è±¡éœ€è¦è®¾ç½®è¿‡æœŸæ—¶é—´
func store<T>(_ object: T, ttl: TimeInterval = 300) -> String {
    // 5åˆ†é’Ÿåè‡ªåŠ¨æ¸…ç†
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **Router æ¼”ç¤ºè¯´æ˜.md** - åŸºç¡€è·¯ç”±ä½¿ç”¨
- **é€šçŸ¥è·¯ç”±å¯åŠ¨æ–¹æ¡ˆ.md** - ä»é€šçŸ¥å¯åŠ¨
- **è·¯ç”±æ¡†æ¶è¯´æ˜.md** - å®Œæ•´æ–‡æ¡£

---

## âœ… æ€»ç»“

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | åº”ç”¨å†… | å¤–éƒ¨å”¤èµ· | æ€§èƒ½ | å¤æ‚åº¦ | æ¨èåº¦ |
|------|--------|---------|------|--------|--------|
| parameters | âœ… | âŒ | â­â­â­â­â­ | â­ | â­â­â­â­â­ |
| å…¨å±€ç¼“å­˜ | âœ… | âœ… | â­â­â­â­ | â­â­â­ | â­â­â­â­ |
| å•ä¾‹ç®¡ç† | âœ… | âœ… | â­â­â­â­ | â­â­ | â­â­â­ |
| åºåˆ—åŒ– | âœ… | âœ… | â­â­ | â­â­â­â­ | â­â­ |

### æ ¸å¿ƒå»ºè®®

âœ… **é¦–é€‰ parameters** - 90% çš„åœºæ™¯éƒ½é€‚ç”¨  
âœ… **å¤§å¯¹è±¡ç”¨ç¼“å­˜** - å›¾ç‰‡ã€è§†é¢‘ã€å¤§æ•°æ®  
âœ… **å¤–éƒ¨å”¤èµ·ç”¨ç¼“å­˜+ID** - æå‰å‡†å¤‡æ•°æ®  
âœ… **é¿å…åºåˆ—åŒ–** - é™¤éå¿…é¡»å¤–éƒ¨å”¤èµ·å°å¯¹è±¡  

---

**ç«‹å³æŸ¥çœ‹å®æˆ˜ç¤ºä¾‹ä»£ç ï¼ğŸ“±**

