# é€šçŸ¥è·¯ç”±å¯åŠ¨æ–¹æ¡ˆ

## ğŸ“± é—®é¢˜åœºæ™¯

### åœºæ™¯æè¿°

å½“ App **å®Œå…¨æœªå¯åŠ¨**æˆ–**å·²è¢«æ€æ­»**æ—¶ï¼š
```
ç”¨æˆ·æ”¶åˆ°æ¨é€é€šçŸ¥ â†’ ç‚¹å‡»é€šçŸ¥ â†’ å¯åŠ¨ App â†’ è·³è½¬åˆ°æŒ‡å®šé¡µé¢
```

### æ ¸å¿ƒé—®é¢˜

```
âŒ é—®é¢˜ï¼š
1. App å¯åŠ¨æ—¶ï¼ŒWindow å’Œ RootViewController è¿˜æœªåˆå§‹åŒ–
2. Router.open() éœ€è¦ currentViewControllerï¼Œä½†æ­¤æ—¶å¯èƒ½è¿˜æ²¡æœ‰
3. è·¯ç”±è°ƒç”¨æ—¶æœºå¤ªæ—©ï¼ŒUI è¿˜æœªå‡†å¤‡å¥½

âœ… è§£å†³ï¼š
ä½¿ç”¨"å»¶è¿Ÿè·¯ç”±"æœºåˆ¶ï¼Œç­‰ UI åˆå§‹åŒ–å®Œæˆåå†æ‰§è¡Œè·¯ç”±
```

---

## ğŸ¯ è§£å†³æ–¹æ¡ˆæ¶æ„

### 1. å»¶è¿Ÿè·¯ç”±æœºåˆ¶

```swift
Router.shared
    â†“
å¯åŠ¨æ—¶ä¿å­˜å¾…å¤„ç†çš„ URL
    â†“
ç­‰å¾… UI åˆå§‹åŒ–å®Œæˆ
    â†“
æ‰§è¡Œå»¶è¿Ÿçš„è·¯ç”±
```

### 2. ç”Ÿå‘½å‘¨æœŸæ—¶åº

```
App å®Œå…¨æœªå¯åŠ¨ï¼š
1. AppDelegate.didFinishLaunching â†’ ä¿å­˜é€šçŸ¥ URL
2. SceneDelegate.willConnectTo â†’ åˆ›å»º Window
3. RootViewController.viewDidAppear â†’ UI å°±ç»ª
4. æ‰§è¡Œå»¶è¿Ÿè·¯ç”± âœ…

App åœ¨åå°ï¼š
1. ç”¨æˆ·ç‚¹å‡»é€šçŸ¥
2. AppDelegate.didReceiveRemoteNotification
3. ç›´æ¥æ‰§è¡Œè·¯ç”±ï¼ˆUI å·²å°±ç»ªï¼‰âœ…

App åœ¨å‰å°ï¼š
1. æ”¶åˆ°é€šçŸ¥
2. ç”¨æˆ·ç‚¹å‡»é€šçŸ¥ï¼ˆæˆ– bannerï¼‰
3. ç›´æ¥æ‰§è¡Œè·¯ç”± âœ…
```

---

## ğŸ’» ä»£ç å®ç°

### 1. Router.swift - æ·»åŠ å»¶è¿Ÿè·¯ç”±æ”¯æŒ

```swift
// MARK: - å»¶è¿Ÿè·¯ç”±ï¼ˆç”¨äºå¯åŠ¨åœºæ™¯ï¼‰

/// å¾…å¤„ç†çš„è·¯ç”±ï¼ˆApp å¯åŠ¨æ—¶å¯èƒ½ UI è¿˜æœªå°±ç»ªï¼‰
private var pendingURLString: String?
private var pendingParameters: [String: Any]?

/// è®¾ç½®å¾…å¤„ç†çš„è·¯ç”±ï¼ˆåœ¨ UI å°±ç»ªå‰è°ƒç”¨ï¼‰
/// é€šå¸¸åœ¨ AppDelegate.didFinishLaunching ä¸­è°ƒç”¨
func setPendingRoute(_ urlString: String, parameters: [String: Any] = [:]) {
    print("ğŸ“Œ è®¾ç½®å¾…å¤„ç†è·¯ç”±ï¼š\(urlString)")
    pendingURLString = urlString
    pendingParameters = parameters
}

/// æ‰§è¡Œå¾…å¤„ç†çš„è·¯ç”±ï¼ˆåœ¨ UI å°±ç»ªåè°ƒç”¨ï¼‰
/// é€šå¸¸åœ¨ RootViewController.viewDidAppear ä¸­è°ƒç”¨
@discardableResult
func executePendingRoute() -> Bool {
    guard let urlString = pendingURLString else {
        return false
    }
    
    print("ğŸš€ æ‰§è¡Œå¾…å¤„ç†è·¯ç”±ï¼š\(urlString)")
    
    let parameters = pendingParameters ?? [:]
    
    // æ¸…é™¤å¾…å¤„ç†çš„è·¯ç”±
    pendingURLString = nil
    pendingParameters = nil
    
    // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿ UI å®Œå…¨å°±ç»ª
    DispatchQueue.main.asyncAfter(deadline: .now() + 0.5) { [weak self] in
        self?.open(urlString, parameters: parameters)
    }
    
    return true
}

/// æ˜¯å¦æœ‰å¾…å¤„ç†çš„è·¯ç”±
var hasPendingRoute: Bool {
    return pendingURLString != nil
}
```

---

### 2. AppDelegate.swift - å¤„ç†é€šçŸ¥å¯åŠ¨

```swift
import UIKit
import UserNotifications

@main
class AppDelegate: UIResponder, UIApplicationDelegate {

    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
        
        // 1. æ³¨å†Œè·¯ç”±
        registerAllRoutes()
        
        // 2. è¯·æ±‚é€šçŸ¥æƒé™
        requestNotificationPermission()
        
        // 3. å¤„ç†ä»é€šçŸ¥å¯åŠ¨çš„æƒ…å†µ
        handleLaunchFromNotification(launchOptions: launchOptions)
        
        return true
    }
    
    // MARK: - è·¯ç”±æ³¨å†Œ
    
    private func registerAllRoutes() {
        let router = Router.shared
        
        router.register("app://user/:userId", viewControllerType: RouteUserDetailViewController.self)
        router.register("app://settings", action: .present) { _ in
            let vc = RouteSettingsViewController()
            return UINavigationController(rootViewController: vc)
        }
        router.register("app://product/:productId", viewControllerType: RouteProductViewController.self)
        router.register("app://search", viewControllerType: RouteSearchViewController.self)
        router.register("app://vip/:vipId", viewControllerType: RouteVIPViewController.self)
        
        // é€šçŸ¥è¯¦æƒ…é¡µï¼ˆæ–°å¢ï¼‰
        router.register("app://notification/:notificationId", viewControllerType: RouteNotificationDetailViewController.self)
        
        print("âœ… åº”ç”¨å¯åŠ¨æ—¶å·²æ³¨å†Œæ‰€æœ‰è·¯ç”±")
    }
    
    // MARK: - é€šçŸ¥å¤„ç†
    
    /// è¯·æ±‚é€šçŸ¥æƒé™
    private func requestNotificationPermission() {
        UNUserNotificationCenter.current().requestAuthorization(options: [.alert, .sound, .badge]) { granted, error in
            if granted {
                print("âœ… é€šçŸ¥æƒé™å·²æˆäºˆ")
                DispatchQueue.main.async {
                    UIApplication.shared.registerForRemoteNotifications()
                }
            } else {
                print("âŒ é€šçŸ¥æƒé™è¢«æ‹’ç»ï¼š\(error?.localizedDescription ?? "")")
            }
        }
        
        // è®¾ç½®é€šçŸ¥ä»£ç†
        UNUserNotificationCenter.current().delegate = self
    }
    
    /// å¤„ç†ä»é€šçŸ¥å¯åŠ¨ï¼ˆApp å®Œå…¨æœªè¿è¡Œæ—¶ï¼‰
    private func handleLaunchFromNotification(launchOptions: [UIApplication.LaunchOptionsKey: Any]?) {
        
        // åœºæ™¯1ï¼šä»è¿œç¨‹æ¨é€é€šçŸ¥å¯åŠ¨
        if let remoteNotification = launchOptions?[.remoteNotification] as? [AnyHashable: Any] {
            print("ğŸ”” ä»è¿œç¨‹é€šçŸ¥å¯åŠ¨ App")
            handleNotificationPayload(remoteNotification, isLaunch: true)
        }
        
        // åœºæ™¯2ï¼šä»æœ¬åœ°é€šçŸ¥å¯åŠ¨
        if let localNotification = launchOptions?[.localNotification] as? UILocalNotification {
            print("ğŸ”” ä»æœ¬åœ°é€šçŸ¥å¯åŠ¨ App")
            if let userInfo = localNotification.userInfo {
                handleNotificationPayload(userInfo, isLaunch: true)
            }
        }
    }
    
    /// å¤„ç†é€šçŸ¥è´Ÿè½½ï¼ˆæå–è·¯ç”±ä¿¡æ¯ï¼‰
    private func handleNotificationPayload(_ userInfo: [AnyHashable: Any], isLaunch: Bool) {
        print("ğŸ“¦ é€šçŸ¥å†…å®¹ï¼š\(userInfo)")
        
        // ä»é€šçŸ¥ä¸­æå–è·¯ç”±ä¿¡æ¯
        // æ ¼å¼ç¤ºä¾‹ï¼š{"route": "app://product/123", "title": "æ–°å•†å“ä¸Šæ¶"}
        
        guard let routeString = userInfo["route"] as? String else {
            print("âš ï¸ é€šçŸ¥ä¸­æ²¡æœ‰è·¯ç”±ä¿¡æ¯")
            return
        }
        
        print("ğŸ”— æå–åˆ°è·¯ç”±ï¼š\(routeString)")
        
        // æå–é¢å¤–å‚æ•°
        var parameters: [String: Any] = [:]
        if let params = userInfo["parameters"] as? [String: Any] {
            parameters = params
        }
        
        if isLaunch {
            // App å¯åŠ¨åœºæ™¯ï¼šè®¾ç½®å¾…å¤„ç†è·¯ç”±
            print("ğŸ“Œ App æ­£åœ¨å¯åŠ¨ï¼Œè®¾ç½®å¾…å¤„ç†è·¯ç”±")
            Router.shared.setPendingRoute(routeString, parameters: parameters)
        } else {
            // App å·²è¿è¡Œåœºæ™¯ï¼šç›´æ¥æ‰§è¡Œè·¯ç”±
            print("ğŸš€ App å·²è¿è¡Œï¼Œç›´æ¥æ‰§è¡Œè·¯ç”±")
            Router.shared.open(routeString, parameters: parameters)
        }
    }
    
    // MARK: - è¿œç¨‹æ¨é€ï¼ˆApp åœ¨åå°æˆ–å‰å°æ—¶ï¼‰
    
    func application(_ application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable: Any]) {
        print("ğŸ”” æ”¶åˆ°è¿œç¨‹æ¨é€é€šçŸ¥ï¼ˆApp åœ¨åå°æˆ–å‰å°ï¼‰")
        handleNotificationPayload(userInfo, isLaunch: false)
    }
    
    func application(_ application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable: Any], fetchCompletionHandler completionHandler: @escaping (UIBackgroundFetchResult) -> Void) {
        print("ğŸ”” æ”¶åˆ°è¿œç¨‹æ¨é€é€šçŸ¥ï¼ˆåå°åˆ·æ–°ï¼‰")
        handleNotificationPayload(userInfo, isLaunch: false)
        completionHandler(.newData)
    }
    
    func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {
        let token = deviceToken.map { String(format: "%02.2hhx", $0) }.joined()
        print("âœ… è·å–åˆ° Device Token: \(token)")
        // è¿™é‡Œåº”è¯¥å°† token å‘é€åˆ°ä½ çš„æœåŠ¡å™¨
    }
    
    func application(_ application: UIApplication, didFailToRegisterForRemoteNotificationsWithError error: Error) {
        print("âŒ æ³¨å†Œè¿œç¨‹é€šçŸ¥å¤±è´¥ï¼š\(error.localizedDescription)")
    }
    
    // MARK: - URL Schemeï¼ˆå¤–éƒ¨å”¤èµ·ï¼‰
    
    func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey: Any] = [:]) -> Bool {
        print("ğŸ”— é€šè¿‡ URL Scheme æ‰“å¼€ï¼š\(url)")
        
        // æ£€æŸ¥ UI æ˜¯å¦å°±ç»ª
        if Router.shared.currentViewController() != nil {
            // UI å·²å°±ç»ªï¼Œç›´æ¥æ‰§è¡Œ
            return Router.shared.open(url)
        } else {
            // UI æœªå°±ç»ªï¼Œè®¾ç½®å¾…å¤„ç†è·¯ç”±
            Router.shared.setPendingRoute(url.absoluteString)
            return true
        }
    }
}

// MARK: - UNUserNotificationCenterDelegate

extension AppDelegate: UNUserNotificationCenterDelegate {
    
    /// å‰å°æ”¶åˆ°é€šçŸ¥
    func userNotificationCenter(_ center: UNUserNotificationCenter, willPresent notification: UNNotification, withCompletionHandler completionHandler: @escaping (UNNotificationPresentationOptions) -> Void) {
        print("ğŸ”” å‰å°æ”¶åˆ°é€šçŸ¥ï¼š\(notification.request.content.userInfo)")
        
        // iOS 14+ æ˜¾ç¤º banner
        if #available(iOS 14.0, *) {
            completionHandler([.banner, .sound, .badge])
        } else {
            completionHandler([.alert, .sound, .badge])
        }
    }
    
    /// ç”¨æˆ·ç‚¹å‡»é€šçŸ¥
    func userNotificationCenter(_ center: UNUserNotificationCenter, didReceive response: UNNotificationResponse, withCompletionHandler completionHandler: @escaping () -> Void) {
        print("ğŸ”” ç”¨æˆ·ç‚¹å‡»äº†é€šçŸ¥")
        
        let userInfo = response.notification.request.content.userInfo
        
        // æ£€æŸ¥ App æ˜¯å¦åˆšå¯åŠ¨
        let isLaunch = Router.shared.currentViewController() == nil
        
        handleNotificationPayload(userInfo, isLaunch: isLaunch)
        
        completionHandler()
    }
}
```

---

### 3. SceneDelegate.swift - å¤„ç†å¤šåœºæ™¯

```swift
import UIKit

class SceneDelegate: UIResponder, UIWindowSceneDelegate {

    var window: UIWindow?

    func scene(_ scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions) {
        guard let windowScene = (scene as? UIWindowScene) else { return }
        
        // åˆ›å»ºçª—å£å’Œæ ¹è§†å›¾æ§åˆ¶å™¨
        window = UIWindow(windowScene: windowScene)
        
        let storyboard = UIStoryboard(name: "Main", bundle: nil)
        let rootVC = storyboard.instantiateInitialViewController()
        
        window?.rootViewController = rootVC
        window?.makeKeyAndVisible()
        
        // å¤„ç†ä»é€šçŸ¥æˆ– URL å¯åŠ¨
        handleConnectionOptions(connectionOptions)
    }
    
    /// å¤„ç†åœºæ™¯è¿æ¥é€‰é¡¹
    private func handleConnectionOptions(_ connectionOptions: UIScene.ConnectionOptions) {
        
        // ä»é€šçŸ¥å¯åŠ¨
        if let notificationResponse = connectionOptions.notificationResponse {
            print("ğŸ”” Scene ä»é€šçŸ¥å“åº”å¯åŠ¨")
            let userInfo = notificationResponse.notification.request.content.userInfo
            handleNotificationPayload(userInfo)
        }
        
        // ä» URL å¯åŠ¨
        if let urlContext = connectionOptions.urlContexts.first {
            print("ğŸ”— Scene ä» URL å¯åŠ¨ï¼š\(urlContext.url)")
            Router.shared.setPendingRoute(urlContext.url.absoluteString)
        }
    }
    
    /// å¤„ç†é€šçŸ¥è´Ÿè½½
    private func handleNotificationPayload(_ userInfo: [AnyHashable: Any]) {
        guard let routeString = userInfo["route"] as? String else {
            return
        }
        
        var parameters: [String: Any] = [:]
        if let params = userInfo["parameters"] as? [String: Any] {
            parameters = params
        }
        
        Router.shared.setPendingRoute(routeString, parameters: parameters)
    }
    
    /// Scene è¿›å…¥å‰å°ï¼ˆä»åå°æ¢å¤ï¼‰
    func sceneDidBecomeActive(_ scene: UIScene) {
        print("ğŸ”„ Scene å·²æ¿€æ´»")
    }
}
```

---

### 4. HomeViewController.swift - æ‰§è¡Œå»¶è¿Ÿè·¯ç”±

```swift
class HomeViewController: UIViewController {
    
    override func viewDidAppear(_ animated: Bool) {
        super.viewDidAppear(animated)
        
        // æ‰§è¡Œå¾…å¤„ç†çš„è·¯ç”±ï¼ˆå¦‚æœæœ‰ï¼‰
        if Router.shared.hasPendingRoute {
            print("ğŸš€ HomeViewController å·²å°±ç»ªï¼Œæ‰§è¡Œå¾…å¤„ç†è·¯ç”±")
            Router.shared.executePendingRoute()
        }
    }
}
```

---

### 5. é€šçŸ¥è¯¦æƒ…é¡µï¼ˆç¤ºä¾‹ï¼‰

```swift
// RoutePages.swift ä¸­æ·»åŠ 

// MARK: - é€šçŸ¥è¯¦æƒ…é¡µ

class RouteNotificationDetailViewController: UIViewController, Routable {
    var notificationId: String?
    var message: String?
    
    static func instantiate(with parameters: [String : Any]) -> Self? {
        let vc = Self()
        vc.notificationId = parameters["notificationId"] as? String
        vc.message = parameters["message"] as? String
        return vc
    }
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        title = "é€šçŸ¥è¯¦æƒ…"
        view.backgroundColor = .systemBackground
        
        let label = UILabel()
        label.text = """
        é€šçŸ¥ IDï¼š\(notificationId ?? "æœªçŸ¥")
        æ¶ˆæ¯ï¼š\(message ?? "æ— ")
        
        ğŸ‰ ä»é€šçŸ¥å¯åŠ¨æˆåŠŸï¼
        """
        label.font = .systemFont(ofSize: 18, weight: .medium)
        label.textAlignment = .center
        label.numberOfLines = 0
        label.translatesAutoresizingMaskIntoConstraints = false
        
        view.addSubview(label)
        
        NSLayoutConstraint.activate([
            label.centerXAnchor.constraint(equalTo: view.centerXAnchor),
            label.centerYAnchor.constraint(equalTo: view.centerYAnchor),
            label.leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: 20),
            label.trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: -20)
        ])
    }
}
```

---

## ğŸ“± é€šçŸ¥è´Ÿè½½æ ¼å¼

### æ¨é€é€šçŸ¥ JSON æ ¼å¼

```json
{
  "aps": {
    "alert": {
      "title": "æ–°å•†å“ä¸Šæ¶",
      "body": "iPhone 16 Pro ç°å·²å¼€å”®"
    },
    "badge": 1,
    "sound": "default"
  },
  "route": "app://product/12345",
  "parameters": {
    "name": "iPhone 16 Pro",
    "price": "7999"
  }
}
```

### æœ¬åœ°é€šçŸ¥ç¤ºä¾‹

```swift
func scheduleLocalNotification() {
    let content = UNMutableNotificationContent()
    content.title = "æµ‹è¯•é€šçŸ¥"
    content.body = "ç‚¹å‡»æŸ¥çœ‹å•†å“è¯¦æƒ…"
    content.sound = .default
    
    // æ·»åŠ è·¯ç”±ä¿¡æ¯
    content.userInfo = [
        "route": "app://product/8888",
        "parameters": [
            "name": "æµ‹è¯•å•†å“",
            "price": "99"
        ]
    ]
    
    // 5ç§’åè§¦å‘
    let trigger = UNTimeIntervalNotificationTrigger(timeInterval: 5, repeats: false)
    
    let request = UNNotificationRequest(identifier: UUID().uuidString, content: content, trigger: trigger)
    
    UNUserNotificationCenter.current().add(request) { error in
        if let error = error {
            print("âŒ æ·»åŠ é€šçŸ¥å¤±è´¥ï¼š\(error)")
        } else {
            print("âœ… é€šçŸ¥å·²è°ƒåº¦")
        }
    }
}
```

---

## ğŸ¯ æ‰€æœ‰å¯åŠ¨åœºæ™¯å¤„ç†

### åœºæ™¯ 1ï¼šApp å®Œå…¨æœªå¯åŠ¨ + ç‚¹å‡»é€šçŸ¥

```
1. ç”¨æˆ·ç‚¹å‡»é€šçŸ¥
2. AppDelegate.didFinishLaunching
   - æ³¨å†Œè·¯ç”±
   - handleLaunchFromNotification
   - Router.setPendingRoute() âœ…
3. SceneDelegate.willConnectTo
   - åˆ›å»º Window
4. HomeViewController.viewDidAppear
   - Router.executePendingRoute() âœ…
5. è·³è½¬åˆ°ç›®æ ‡é¡µé¢ âœ…
```

### åœºæ™¯ 2ï¼šApp åœ¨åå° + ç‚¹å‡»é€šçŸ¥

```
1. ç”¨æˆ·ç‚¹å‡»é€šçŸ¥
2. UNUserNotificationCenterDelegate.didReceive
   - currentViewController != nilï¼ˆå·²å°±ç»ªï¼‰
   - Router.open() ç›´æ¥æ‰§è¡Œ âœ…
3. è·³è½¬åˆ°ç›®æ ‡é¡µé¢ âœ…
```

### åœºæ™¯ 3ï¼šApp åœ¨å‰å° + æ”¶åˆ°é€šçŸ¥

```
1. æ”¶åˆ°é€šçŸ¥
2. UNUserNotificationCenterDelegate.willPresent
   - æ˜¾ç¤º banner
3. ç”¨æˆ·ç‚¹å‡» banner
4. didReceive å“åº”
5. Router.open() ç›´æ¥æ‰§è¡Œ âœ…
```

### åœºæ™¯ 4ï¼šé€šè¿‡ URL Scheme å¯åŠ¨

```
myapp://product/123

1. AppDelegate.application(_:open:options:)
2. æ£€æŸ¥ currentViewController
3. å¦‚æœ nil â†’ setPendingRoute()
4. å¦‚æœæœ‰ â†’ ç›´æ¥ open()
```

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. æµ‹è¯•æœ¬åœ°é€šçŸ¥å¯åŠ¨

åœ¨ Router æ¼”ç¤ºé¡µé¢æ·»åŠ æŒ‰é’®ï¼š

```swift
// RouterDemoViewController.swift

@objc private func testNotification() {
    log("ğŸ“¤ å‘é€æœ¬åœ°é€šçŸ¥ï¼ˆ5ç§’åï¼‰")
    
    let content = UNMutableNotificationContent()
    content.title = "æµ‹è¯•è·¯ç”±"
    content.body = "ç‚¹å‡»æŸ¥çœ‹ VIP é¡µé¢"
    content.sound = .default
    content.userInfo = [
        "route": "app://vip/999",
        "parameters": ["from": "notification"]
    ]
    
    let trigger = UNTimeIntervalNotificationTrigger(timeInterval: 5, repeats: false)
    let request = UNNotificationRequest(identifier: "test", content: content, trigger: trigger)
    
    UNUserNotificationCenter.current().add(request) { error in
        if error == nil {
            DispatchQueue.main.async { [weak self] in
                self?.log("âœ… é€šçŸ¥å·²å‘é€ï¼Œè¯·ç­‰å¾… 5 ç§’")
            }
        }
    }
}
```

### 2. æµ‹è¯•æ­¥éª¤

```
æ­¥éª¤ 1ï¼šæµ‹è¯•å‰å°é€šçŸ¥
1. è¿è¡Œ App
2. ç‚¹å‡» [å‘é€æµ‹è¯•é€šçŸ¥]
3. ç­‰å¾… 5 ç§’
4. ç‚¹å‡»é€šçŸ¥ banner
5. âœ… åº”è¯¥è·³è½¬åˆ° VIP é¡µé¢

æ­¥éª¤ 2ï¼šæµ‹è¯•åå°å¯åŠ¨
1. è¿è¡Œ App
2. ç‚¹å‡» [å‘é€æµ‹è¯•é€šçŸ¥]
3. æŒ‰ Home é”®ï¼ˆApp è¿›å…¥åå°ï¼‰
4. ç­‰å¾…é€šçŸ¥å‡ºç°
5. ç‚¹å‡»é€šçŸ¥
6. âœ… App å›åˆ°å‰å°å¹¶è·³è½¬

æ­¥éª¤ 3ï¼šæµ‹è¯•å®Œå…¨å¯åŠ¨
1. è¿è¡Œ App
2. ç‚¹å‡» [å‘é€æµ‹è¯•é€šçŸ¥]
3. ä»å¤šä»»åŠ¡ç®¡ç†å™¨å®Œå…¨æ€æ­» App
4. ç­‰å¾…é€šçŸ¥å‡ºç°
5. ç‚¹å‡»é€šçŸ¥
6. âœ… App å¯åŠ¨å¹¶è·³è½¬åˆ° VIP é¡µé¢
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. è·¯ç”±å»¶è¿Ÿæ‰§è¡Œ

```swift
âœ… å¥½ï¼šç­‰å¾… UI å°±ç»ª
Router.shared.setPendingRoute(...)
// åœ¨ viewDidAppear ä¸­æ‰§è¡Œ

âŒ å·®ï¼šç«‹å³æ‰§è¡Œ
Router.shared.open(...)  // Window å¯èƒ½è¿˜æ²¡åˆ›å»º
```

### 2. é€šçŸ¥æƒé™

```swift
// åœ¨ AppDelegate å¯åŠ¨æ—¶è¯·æ±‚
func application(...) -> Bool {
    requestNotificationPermission()
    return true
}
```

### 3. é€šçŸ¥è´Ÿè½½è®¾è®¡

```swift
âœ… å¥½ï¼šåŒ…å«å®Œæ•´è·¯ç”±ä¿¡æ¯
{
  "route": "app://product/123",
  "parameters": {...}
}

âŒ å·®ï¼šåªæœ‰ IDï¼Œéœ€è¦é¢å¤–æŸ¥è¯¢
{
  "productId": "123"  // éœ€è¦ä¸šåŠ¡å±‚å¤„ç†
}
```

### 4. å¤šæ¬¡å»¶è¿Ÿè·¯ç”±

```swift
// åªä¿ç•™æœ€æ–°çš„å¾…å¤„ç†è·¯ç”±
func setPendingRoute(...) {
    if pendingURLString != nil {
        print("âš ï¸ è¦†ç›–ä¹‹å‰çš„å¾…å¤„ç†è·¯ç”±")
    }
    pendingURLString = urlString
}
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æ—¥å¿—è¿½è¸ª

åœ¨æ‰€æœ‰å…³é”®ç‚¹æ·»åŠ æ—¥å¿—ï¼š
```swift
print("ğŸ”” [Notification] æ”¶åˆ°é€šçŸ¥")
print("ğŸ“Œ [Router] è®¾ç½®å¾…å¤„ç†è·¯ç”±")
print("ğŸš€ [Router] æ‰§è¡Œå¾…å¤„ç†è·¯ç”±")
print("âœ… [Router] è·¯ç”±æ‰§è¡Œå®Œæˆ")
```

### 2. æ¨¡æ‹Ÿå™¨æµ‹è¯•

```bash
# æ¨¡æ‹Ÿæ¨é€é€šçŸ¥ï¼ˆéœ€è¦ Xcode 11.4+ï¼‰
xcrun simctl push booted com.yourcompany.jiagou notification.json
```

### 3. Xcode æ–­ç‚¹

åœ¨ä»¥ä¸‹ä½ç½®è®¾ç½®æ–­ç‚¹ï¼š
- `setPendingRoute`
- `executePendingRoute`
- `didReceive response`

---

## âœ… å®Œæ•´æ¸…å•

å®ç°é€šçŸ¥è·¯ç”±å¯åŠ¨éœ€è¦ï¼š

- [ ] Router æ·»åŠ  `setPendingRoute()` å’Œ `executePendingRoute()`
- [ ] AppDelegate å¤„ç†é€šçŸ¥å¯åŠ¨åœºæ™¯
- [ ] AppDelegate å®ç° `UNUserNotificationCenterDelegate`
- [ ] SceneDelegate å¤„ç†åœºæ™¯è¿æ¥é€‰é¡¹
- [ ] HomeViewController åœ¨ `viewDidAppear` æ‰§è¡Œå»¶è¿Ÿè·¯ç”±
- [ ] å®šä¹‰é€šçŸ¥è´Ÿè½½æ ¼å¼ï¼ˆåŒ…å« route å­—æ®µï¼‰
- [ ] è¯·æ±‚é€šçŸ¥æƒé™
- [ ] æ·»åŠ æµ‹è¯•æŒ‰é’®å’Œæ–¹æ³•
- [ ] æµ‹è¯•æ‰€æœ‰å¯åŠ¨åœºæ™¯

---

**å®ç°å®Œæˆåï¼Œæ— è®º App å¤„äºä½•ç§çŠ¶æ€ï¼Œéƒ½èƒ½é€šè¿‡é€šçŸ¥æ­£ç¡®è·³è½¬ï¼ğŸ‰**

