# åè®®å±‚è§£è€¦åŸç†è¯¦è§£

## ğŸ“Œ é—®é¢˜åœºæ™¯

### å‡è®¾é¡¹ç›®ç»“æ„

```
MyApp/
â”œâ”€â”€ Podfile
â””â”€â”€ Pods/
    â”œâ”€â”€ UserModule/          # ç”¨æˆ·æ¨¡å—ï¼ˆç‹¬ç«‹ Podï¼‰
    â””â”€â”€ ProductModule/       # å•†å“æ¨¡å—ï¼ˆç‹¬ç«‹ Podï¼‰
```

### éœ€æ±‚

ProductModule éœ€è¦æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼Œæ€ä¹ˆè°ƒç”¨ UserModule çš„æœåŠ¡ï¼Ÿ

---

## âŒ é”™è¯¯æ–¹æ¡ˆï¼šç›´æ¥ä¾èµ–

### Podfile é…ç½®

```ruby
# ProductModule.podspec

s.dependency 'UserModule'  # âŒ ç›´æ¥ä¾èµ– UserModule
```

### ä»£ç å®ç°

```swift
// ProductModule/ProductModule.swift

import UIKit
import UserModule  // âŒ å¯¼å…¥ UserModuleï¼Œäº§ç”Ÿä¾èµ–

class ProductModule {
    func addToCart(productId: String) -> Bool {
        // ç›´æ¥ä½¿ç”¨ UserModule
        let userModule = UserModule.shared
        
        if let user = userModule.getCurrentUser() {
            print("ç”¨æˆ· \(user.name) æ·»åŠ å•†å“")
            return true
        }
        return false
    }
}
```

### é—®é¢˜åˆ†æ

```
ProductModule â†’ UserModule

âŒ é—®é¢˜ï¼š
1. ProductModule ä¾èµ– UserModule
2. æ— æ³•ç‹¬ç«‹ç¼–è¯‘ ProductModule
3. æ— æ³•å•ç‹¬æµ‹è¯• ProductModule
4. å¦‚æœ UserModule æœªå®‰è£…ï¼ŒProductModule ç¼–è¯‘å¤±è´¥
5. å½¢æˆå¾ªç¯ä¾èµ–ï¼ˆUserModule ä¹Ÿå¯èƒ½éœ€è¦ ProductModuleï¼‰
```

---

## âœ… æ­£ç¡®æ–¹æ¡ˆï¼šåè®®å±‚è§£è€¦

### ä¸‰å±‚æ¶æ„

```
Layer 1: App ä¸»å·¥ç¨‹
         â†“ (ä¾èµ–æ‰€æœ‰)
Layer 2: åè®®å±‚ (ModuleProtocols Pod)
         â†“ (æ‰€æœ‰æ¨¡å—éƒ½ä¾èµ–)
Layer 3: ä¸šåŠ¡æ¨¡å— (UserModule, ProductModule...)
```

### Podfile é…ç½®

```ruby
# Podfile

platform :ios, '13.0'
use_frameworks!

target 'MyApp' do
  # åè®®å±‚
  pod 'ModuleProtocols', :path => './LocalPods/ModuleProtocols'
  
  # ä¸šåŠ¡æ¨¡å—
  pod 'UserModule', :path => './LocalPods/UserModule'
  pod 'ProductModule', :path => './LocalPods/ProductModule'
end
```

### å„ Pod çš„ä¾èµ–é…ç½®

#### ModuleProtocols.podspecï¼ˆåè®®å±‚ï¼‰

```ruby
Pod::Spec.new do |s|
  s.name = "ModuleProtocols"
  # ...
  
  # âœ… ä¸ä¾èµ–ä»»ä½•ä¸šåŠ¡æ¨¡å—
  # åªå¯ä»¥ä¾èµ–åŸºç¡€åº“
end
```

#### UserModule.podspec

```ruby
Pod::Spec.new do |s|
  s.name = "UserModule"
  # ...
  
  # âœ… åªä¾èµ–åè®®å±‚
  s.dependency 'ModuleProtocols', '~> 1.0'
  
  # âŒ ä¸ä¾èµ–å…¶ä»–ä¸šåŠ¡æ¨¡å—
  # s.dependency 'ProductModule'  # ç¦æ­¢
end
```

#### ProductModule.podspec

```ruby
Pod::Spec.new do |s|
  s.name = "ProductModule"
  # ...
  
  # âœ… åªä¾èµ–åè®®å±‚
  s.dependency 'ModuleProtocols', '~> 1.0'
  
  # âŒ ä¸ä¾èµ–å…¶ä»–ä¸šåŠ¡æ¨¡å—
  # s.dependency 'UserModule'  # ç¦æ­¢
end
```

---

## ğŸ’» ä»£ç å¯¹æ¯”

### åè®®å±‚ï¼ˆModuleProtocols Podï¼‰

```swift
// ModuleProtocols/Protocols/UserModuleProtocol.swift

import UIKit

/// ç”¨æˆ·æ¨¡å—åè®®ï¼ˆæ¥å£å®šä¹‰ï¼‰
public protocol UserModuleProtocol: ModuleProtocol {
    func getCurrentUser() -> User?
    func isLoggedIn() -> Bool
    func login(username: String, password: String, completion: @escaping (Bool) -> Void)
}
```

```swift
// ModuleProtocols/Models/User.swift

import Foundation

/// ç”¨æˆ·æ•°æ®æ¨¡å‹
public struct User {
    public let id: String
    public let name: String
    
    public init(id: String, name: String) {
        self.id = id
        self.name = name
    }
}
```

---

### UserModule Podï¼ˆå®ç°åè®®ï¼‰

```swift
// UserModule/UserModule.swift

import UIKit
import ModuleProtocols  // âœ… åªä¾èµ–åè®®å±‚

/// ç”¨æˆ·æ¨¡å—å®ç°
public class UserModule: UserModuleProtocol {
    public static let moduleName = "UserModule"
    
    private var currentUser: User?
    
    public required init() {}
    
    // å®ç°åè®®æ–¹æ³•
    public func getCurrentUser() -> User? {
        return currentUser
    }
    
    public func isLoggedIn() -> Bool {
        return currentUser != nil
    }
    
    public func login(username: String, password: String, completion: @escaping (Bool) -> Void) {
        // ç™»å½•é€»è¾‘
        currentUser = User(id: "123", name: username)
        completion(true)
    }
}
```

---

### ProductModule Podï¼ˆé€šè¿‡åè®®è°ƒç”¨ï¼‰

```swift
// ProductModule/ProductModule.swift

import UIKit
import ModuleProtocols  // âœ… åªä¾èµ–åè®®å±‚
// âŒ ä¸éœ€è¦ import UserModule

/// å•†å“æ¨¡å—å®ç°
public class ProductModule: ProductModuleProtocol {
    public static let moduleName = "ProductModule"
    
    public required init() {}
    
    public func addToCart(productId: String, quantity: Int) -> Bool {
        
        // âœ… å…³é”®ï¼šé€šè¿‡åè®®ç±»å‹è·å–æ¨¡å—
        // ä¸éœ€è¦çŸ¥é“ UserModule çš„å…·ä½“å®ç°
        guard let userModule = ModuleManager.shared.module(UserModuleProtocol.self) else {
            print("âŒ æ— æ³•è·å–ç”¨æˆ·æ¨¡å—")
            return false
        }
        
        // é€šè¿‡åè®®è°ƒç”¨æœåŠ¡
        guard let user = userModule.getCurrentUser() else {
            print("âŒ ç”¨æˆ·æœªç™»å½•")
            return false
        }
        
        print("âœ… ç”¨æˆ· \(user.name) æ·»åŠ å•†å“ \(productId)")
        return true
    }
}
```

---

## ğŸ” å…³é”®å¯¹æ¯”

### ä¼ ç»Ÿæ–¹å¼ï¼ˆâŒ äº§ç”Ÿä¾èµ–ï¼‰

```swift
// ProductModule/ProductModule.swift

import UserModule  // âŒ éœ€è¦å¯¼å…¥å…·ä½“æ¨¡å—

func addToCart() -> Bool {
    let userModule = UserModule.shared  // âŒ ç›´æ¥ä½¿ç”¨å…·ä½“ç±»
    let user = userModule.getCurrentUser()
    // ...
}
```

**ä¾èµ–å…³ç³»ï¼š**
```
ProductModule.podspec:
  s.dependency 'UserModule'  âŒ äº§ç”Ÿä¾èµ–
```

---

### åè®®å±‚æ–¹å¼ï¼ˆâœ… å®Œå…¨è§£è€¦ï¼‰

```swift
// ProductModule/ProductModule.swift

import ModuleProtocols  // âœ… åªå¯¼å…¥åè®®å±‚

func addToCart() -> Bool {
    // âœ… é€šè¿‡åè®®ç±»å‹è·å–æ¨¡å—
    let userModule = ModuleManager.shared.module(UserModuleProtocol.self)
    let user = userModule?.getCurrentUser()
    // ...
}
```

**ä¾èµ–å…³ç³»ï¼š**
```
ProductModule.podspec:
  s.dependency 'ModuleProtocols'  âœ… åªä¾èµ–åè®®å±‚

UserModule.podspec:
  s.dependency 'ModuleProtocols'  âœ… åªä¾èµ–åè®®å±‚
```

---

## ğŸ¯ ModuleManager çš„é­”æ³•

### å…³é”®å®ç°

```swift
public class ModuleManager {
    private var modules: [String: ModuleProtocol.Type] = [:]
    
    // æ³¨å†Œå…·ä½“å®ç°ç±»
    public func register<T: ModuleProtocol>(_ moduleType: T.Type) {
        modules[moduleType.moduleName] = moduleType
    }
    
    // âœ… å…³é”®ï¼šé€šè¿‡åè®®ç±»å‹æŸ¥æ‰¾å®ç°
    public func module<T: ModuleProtocol>(_ protocolType: T.Type) -> T? {
        for (_, moduleType) in modules {
            // æ£€æŸ¥æ˜¯å¦å®ç°äº†è¯¥åè®®
            if let module = moduleType as? T.Type {
                return module.init()
            }
        }
        return nil
    }
}
```

### å·¥ä½œåŸç†

```
1. App ä¸»å·¥ç¨‹æ³¨å†Œæ¨¡å—ï¼š
   ModuleManager.shared.register(UserModule.self)
   
   modules = [
       "UserModule": UserModule.Type  // å®ç°äº† UserModuleProtocol
   ]

2. ProductModule è·å–æ¨¡å—ï¼š
   let userModule = ModuleManager.shared.module(UserModuleProtocol.self)
   
   è¿‡ç¨‹ï¼š
   - éå† modules
   - æ£€æŸ¥ UserModule.Type æ˜¯å¦å®ç° UserModuleProtocol
   - æ˜¯ â†’ è¿”å› UserModule å®ä¾‹ï¼ˆä½œä¸º UserModuleProtocol ç±»å‹ï¼‰
   - å¦ â†’ è¿”å› nil

3. è°ƒç”¨æœåŠ¡ï¼š
   userModule.getCurrentUser()  // âœ… é€šè¿‡åè®®è°ƒç”¨ï¼Œä¸çŸ¥é“å…·ä½“å®ç°
```

---

## ğŸ“¦ Pod å¼€å‘æµç¨‹

### 1. åˆ›å»º ModuleProtocols Pod

```bash
cd LocalPods
pod lib create ModuleProtocols

# é€‰æ‹©ï¼š
- Language: Swift
- Include a demo application: No
- Test framework: None
- View-based testing: No
```

### 2. åˆ›å»º UserModule Pod

```bash
cd LocalPods
pod lib create UserModule

# ç¼–è¾‘ UserModule.podspec
s.dependency 'ModuleProtocols', '~> 1.0'
```

### 3. åˆ›å»º ProductModule Pod

```bash
cd LocalPods
pod lib create ProductModule

# ç¼–è¾‘ ProductModule.podspec
s.dependency 'ModuleProtocols', '~> 1.0'
```

### 4. ä¸»å·¥ç¨‹å®‰è£… Pods

```bash
cd MyApp
pod install
```

---

## ğŸ§ª ç‹¬ç«‹æµ‹è¯•

### æµ‹è¯• ProductModuleï¼ˆä¸éœ€è¦ UserModuleï¼‰

```swift
// ProductModuleTests.swift

import XCTest
import ModuleProtocols
@testable import ProductModule

class ProductModuleTests: XCTestCase {
    
    func testAddToCart() {
        // 1. æ³¨å†Œ Mock UserModule
        let mockUserModule = MockUserModule()
        ModuleManager.shared.register(type(of: mockUserModule))
        
        // 2. æµ‹è¯• ProductModule
        let productModule = ProductModule()
        let success = productModule.addToCart(productId: "123", quantity: 1)
        
        XCTAssertTrue(success)
    }
}

// Mock UserModule
class MockUserModule: UserModuleProtocol {
    static let moduleName = "UserModule"
    
    required init() {}
    
    func getCurrentUser() -> User? {
        return User(id: "test", name: "Test User")
    }
    
    func isLoggedIn() -> Bool {
        return true
    }
    
    // ... å…¶ä»–æ–¹æ³•
}
```

---

## ğŸ“Š å¯¹æ¯”æ€»ç»“

| ç‰¹æ€§ | ç›´æ¥ä¾èµ– | åè®®å±‚è§£è€¦ |
|------|---------|-----------|
| **æ¨¡å—ä¾èµ–** | âŒ ç›¸äº’ä¾èµ– | âœ… é›¶ä¾èµ– |
| **ç‹¬ç«‹ç¼–è¯‘** | âŒ éœ€è¦å…¶ä»–æ¨¡å— | âœ… å¯ç‹¬ç«‹ç¼–è¯‘ |
| **ç‹¬ç«‹æµ‹è¯•** | âŒ éœ€è¦çœŸå®æ¨¡å— | âœ… å¯ Mock |
| **å›¢é˜Ÿåä½œ** | âŒ äº’ç›¸ç­‰å¾… | âœ… å¹¶è¡Œå¼€å‘ |
| **ç‰ˆæœ¬ç®¡ç†** | âŒ è€¦åˆå‡çº§ | âœ… ç‹¬ç«‹å‡çº§ |
| **ä»£ç å¤ç”¨** | âŒ éš¾ä»¥å¤ç”¨ | âœ… æ˜“äºå¤ç”¨ |

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åè®®å±‚ä¿æŒç¨³å®š

```
ModuleProtocols ç‰ˆæœ¬ï¼š1.0.0
- åè®®å®šä¹‰å°½é‡ç¨³å®š
- æ–°å¢æ–¹æ³•ä½¿ç”¨å¯é€‰å®ç°ï¼ˆextensionï¼‰
- é¿å…é¢‘ç¹ä¿®æ”¹åè®®
```

### 2. æ¨¡å—ç‰ˆæœ¬ç‹¬ç«‹

```
UserModule ç‰ˆæœ¬ï¼š2.5.1
ProductModule ç‰ˆæœ¬ï¼š3.1.0

éƒ½ä¾èµ–ï¼š
ModuleProtocols ~> 1.0ï¼ˆå…¼å®¹æ‰€æœ‰ 1.x ç‰ˆæœ¬ï¼‰
```

### 3. åè®®æ‰©å±•ï¼ˆå‘åå…¼å®¹ï¼‰

```swift
// ModuleProtocols 1.0.0
public protocol UserModuleProtocol {
    func getCurrentUser() -> User?
}

// ModuleProtocols 1.1.0ï¼ˆæ–°å¢æ–¹æ³•ï¼‰
extension UserModuleProtocol {
    // é»˜è®¤å®ç°ï¼Œä¸ç ´åå…¼å®¹æ€§
    func getUserAvatar() -> UIImage? {
        return nil
    }
}
```

---

## âœ… æ€»ç»“

### æ ¸å¿ƒåŸç†

**ProductModule å’Œ UserModule éƒ½åªä¾èµ–åè®®å±‚ï¼Œé€šè¿‡ ModuleManager ä¸­ä»‹è€…è¿›è¡Œé€šä¿¡**

### å…³é”®ä»£ç 

```swift
// ProductModule ä¸­ï¼ˆä¸éœ€è¦ import UserModuleï¼‰
import ModuleProtocols  // âœ… åªä¾èµ–åè®®å±‚

// é€šè¿‡åè®®ç±»å‹è·å–æ¨¡å—
let userModule = ModuleManager.shared.module(UserModuleProtocol.self)

// è°ƒç”¨åè®®æ–¹æ³•
let user = userModule?.getCurrentUser()
```

### ä¾èµ–å…³ç³»

```
         ModuleProtocols Podï¼ˆåè®®å±‚ï¼‰
               â†™        â†˜
    UserModule Pod    ProductModule Pod
         â†–                  â†™
              App ä¸»å·¥ç¨‹
             ï¼ˆæ³¨å†Œæ‰€æœ‰æ¨¡å—ï¼‰
```

### æ ¸å¿ƒä»·å€¼

âœ… **å®Œå…¨è§£è€¦** - æ¨¡å—é—´é›¶ä¾èµ–  
âœ… **ç‹¬ç«‹å¼€å‘** - å›¢é˜Ÿå¹¶è¡Œå·¥ä½œ  
âœ… **ç‹¬ç«‹æµ‹è¯•** - å¯ Mock å¯æ›¿æ¢  
âœ… **çµæ´»æ‰©å±•** - æ–°å¢æ¨¡å—ä¸å½±å“æ—§æ¨¡å—  

---

**è¿™å°±æ˜¯å¤§å‚ä½¿ç”¨çš„ç»„ä»¶åŒ–æ–¹æ¡ˆï¼åè®®å±‚æ˜¯å…³é”®ï¼ğŸš€**

