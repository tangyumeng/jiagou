# å¿«é€Ÿå…¥é—¨æŒ‡å—

5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹å¤šä»»åŠ¡ä¸‹è½½å™¨ï¼

---

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šè¿è¡Œé¡¹ç›®

### 1. æ‰“å¼€é¡¹ç›®
```bash
cd /Users/tangyumeng/Documents/ios-learn/jiagou
open jiagou.xcodeproj
```

### 2. é€‰æ‹©æ¨¡æ‹Ÿå™¨
- é€‰æ‹© iPhone 14 Pro æˆ–ä»»æ„æ¨¡æ‹Ÿå™¨
- ç‚¹å‡»è¿è¡ŒæŒ‰é’® (âŒ˜R)

### 3. æŸ¥çœ‹ç•Œé¢
- åº”è¯¥çœ‹åˆ°æ ‡é¢˜ä¸º"å¤šä»»åŠ¡ä¸‹è½½å™¨"çš„ç•Œé¢
- å·¦ä¸Šè§’æœ‰"æ¸…é™¤å·²å®Œæˆ"æŒ‰é’®
- å³ä¸Šè§’æœ‰"+"æŒ‰é’®

---

## ğŸ“¥ ç¬¬äºŒæ­¥ï¼šæ·»åŠ ä¸‹è½½ä»»åŠ¡

### æ–¹æ³•1ï¼šä½¿ç”¨æµ‹è¯•æ–‡ä»¶

1. ç‚¹å‡»å³ä¸Šè§’ **"+"** æŒ‰é’®
2. é€‰æ‹© **"æµ‹è¯•æ–‡ä»¶ 1: 100MB.bin"**
3. ä»»åŠ¡è‡ªåŠ¨å¼€å§‹ä¸‹è½½

### æ–¹æ³•2ï¼šè‡ªå®šä¹‰URL

1. ç‚¹å‡»å³ä¸Šè§’ **"+"** æŒ‰é’®
2. é€‰æ‹© **"è¾“å…¥è‡ªå®šä¹‰URL"**
3. è¾“å…¥ä»»æ„ä¸‹è½½é“¾æ¥ï¼Œä¾‹å¦‚ï¼š
   ```
   https://speed.hetzner.de/100MB.bin
   ```
4. ç‚¹å‡»"æ·»åŠ "

---

## ğŸ® ç¬¬ä¸‰æ­¥ï¼šæ§åˆ¶ä¸‹è½½

### æš‚åœä¸‹è½½
ç‚¹å‡»ä»»åŠ¡å³ä¾§çš„ **"æš‚åœ"** æŒ‰é’®

### ç»§ç»­ä¸‹è½½
ç‚¹å‡»ä»»åŠ¡å³ä¾§çš„ **"ç»§ç»­"** æŒ‰é’®

### åˆ é™¤ä»»åŠ¡
åœ¨ä»»åŠ¡ä¸Š **å‘å·¦æ»‘åŠ¨**ï¼Œç‚¹å‡» **"åˆ é™¤"**

### æ¸…é™¤å·²å®Œæˆ
ç‚¹å‡»å·¦ä¸Šè§’ **"æ¸…é™¤å·²å®Œæˆ"** æŒ‰é’®

---

## ğŸ‘€ ç¬¬å››æ­¥ï¼šè§‚å¯Ÿæ•ˆæœ

### æŸ¥çœ‹è¿›åº¦
- è¿›åº¦æ¡å®æ—¶æ›´æ–°
- æ˜¾ç¤ºç™¾åˆ†æ¯”ï¼ˆå¦‚ï¼š45.2%ï¼‰
- æ˜¾ç¤ºä¸‹è½½é€Ÿåº¦ï¼ˆå¦‚ï¼š2.5 MB/sï¼‰

### æŸ¥çœ‹çŠ¶æ€
- **ç­‰å¾…ä¸­** - ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…
- **ä¸‹è½½ä¸­** - æ­£åœ¨ä¸‹è½½
- **å·²æš‚åœ** - ç”¨æˆ·æš‚åœ
- **å·²å®Œæˆ** - ä¸‹è½½å®Œæˆ
- **å¤±è´¥** - ä¸‹è½½å¤±è´¥ï¼ˆå¯é‡è¯•ï¼‰

### å¹¶å‘æ§åˆ¶
æ·»åŠ å¤šä¸ªä»»åŠ¡ï¼Œè§‚å¯Ÿï¼š
- æœ€å¤šåŒæ—¶ä¸‹è½½3ä¸ª
- å…¶ä»–ä»»åŠ¡æ˜¾ç¤º"ç­‰å¾…ä¸­"
- ä»»åŠ¡å®Œæˆåè‡ªåŠ¨å¯åŠ¨ä¸‹ä¸€ä¸ª

---

## ğŸ’» ç¬¬äº”æ­¥ï¼šæŸ¥çœ‹ä»£ç 

### æ ¸å¿ƒæ–‡ä»¶ä½ç½®

```
jiagou/
â”œâ”€â”€ DownloadTask.swift          â† ä»»åŠ¡æ¨¡å‹
â”œâ”€â”€ DownloadManager.swift       â† ä¸‹è½½ç®¡ç†å™¨
â”œâ”€â”€ DownloadTaskCell.swift      â† è‡ªå®šä¹‰Cell
â””â”€â”€ ViewController.swift        â† ä¸»æ§åˆ¶å™¨
```

### å…³é”®ä»£ç ç‰‡æ®µ

#### 1. æ·»åŠ ä»»åŠ¡ï¼ˆViewController.swiftï¼‰
```swift
// ç¬¬156-170è¡Œ
private func createDownloadTask(urlString: String) {
    guard let url = URL(string: urlString) else {
        showError(message: "æ— æ•ˆçš„URL")
        return
    }
    
    let task = downloadManager.addTask(url: url)
    setupTaskObservers(task)
    tasks.insert(task, at: 0)
    
    tableView.insertRows(at: [IndexPath(row: 0, section: 0)], with: .automatic)
    
    // è‡ªåŠ¨å¼€å§‹ä¸‹è½½
    downloadManager.startDownload(taskId: task.id)
}
```

#### 2. ä¸‹è½½ç®¡ç†å™¨ï¼ˆDownloadManager.swiftï¼‰
```swift
// ç¬¬50-60è¡Œ
func addTask(url: URL, fileName: String? = nil) -> DownloadTask {
    let task = DownloadTask(url: url, fileName: fileName)
    task.destinationPath = downloadDirectory.appendingPathComponent(task.fileName)
    
    taskQueue.async(flags: .barrier) { [weak self] in
        self?.tasks[task.id] = task
    }
    
    startNextTaskIfPossible()
    return task
}
```

#### 3. ç›‘å¬è¿›åº¦ï¼ˆViewController.swiftï¼‰
```swift
// ç¬¬87-97è¡Œ
private func setupTaskObservers(_ task: DownloadTask) {
    // è¿›åº¦å˜åŒ–å›è°ƒ
    task.onProgressChanged = { [weak self] _ in
        self?.updateTaskCell(task)
    }
    
    // çŠ¶æ€å˜åŒ–å›è°ƒ
    task.onStateChanged = { [weak self] _ in
        self?.updateTaskCell(task)
    }
}
```

---

## ğŸ¯ å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šä¸‹è½½å¤§æ–‡ä»¶
```swift
let url = URL(string: "https://speed.hetzner.de/1GB.bin")!
let task = DownloadManager.shared.addTask(url: url)
DownloadManager.shared.startDownload(taskId: task.id)
```

### åœºæ™¯2ï¼šæ‰¹é‡ä¸‹è½½
```swift
let urls = [
    "https://example.com/file1.zip",
    "https://example.com/file2.pdf",
    "https://example.com/file3.mp4"
]

for urlString in urls {
    if let url = URL(string: urlString) {
        let task = DownloadManager.shared.addTask(url: url)
        DownloadManager.shared.startDownload(taskId: task.id)
    }
}
```

### åœºæ™¯3ï¼šç›‘å¬å®Œæˆäº‹ä»¶
```swift
class MyViewController: UIViewController {
    override func viewDidLoad() {
        super.viewDidLoad()
        DownloadManager.shared.delegate = self
    }
}

extension MyViewController: DownloadManagerDelegate {
    func downloadManager(_ manager: DownloadManager, didCompleteTask task: DownloadTask) {
        print("âœ… ä¸‹è½½å®Œæˆ: \(task.fileName)")
        // å¤„ç†å®Œæˆçš„æ–‡ä»¶
    }
    
    func downloadManager(_ manager: DownloadManager, didFailTask task: DownloadTask, withError error: Error) {
        print("âŒ ä¸‹è½½å¤±è´¥: \(error.localizedDescription)")
    }
    
    func downloadManager(_ manager: DownloadManager, didUpdateTask task: DownloadTask) {
        // æ›´æ–°UI
    }
}
```

---

## ğŸ”§ é…ç½®é€‰é¡¹

### ä¿®æ”¹æœ€å¤§å¹¶å‘æ•°
```swift
// DownloadManager.swift ç¬¬25è¡Œ
private let maxConcurrentDownloads = 3  // æ”¹ä¸ºä½ æƒ³è¦çš„æ•°é‡
```

### ä¿®æ”¹ä¸‹è½½ç›®å½•
```swift
// DownloadManager.swift ç¬¬30-42è¡Œ
private lazy var downloadDirectory: URL = {
    let paths = fileManager.urls(for: .documentDirectory, in: .userDomainMask)
    let documentsDirectory = paths[0]
    return documentsDirectory.appendingPathComponent("Downloads")
}()
```

### æ·»åŠ æµ‹è¯•URL
```swift
// ViewController.swift ç¬¬36-42è¡Œ
private let testURLs = [
    "https://your-custom-url.com/file.zip",
    // æ·»åŠ æ›´å¤šURL
]
```

---

## ğŸ“± æµ‹è¯•å»ºè®®

### æ¨èæµ‹è¯•æµç¨‹

1. **å•ä»»åŠ¡æµ‹è¯•**
   - æ·»åŠ 1ä¸ªä»»åŠ¡
   - æµ‹è¯•æš‚åœ/ç»§ç»­
   - æµ‹è¯•å–æ¶ˆ/é‡æ–°ä¸‹è½½

2. **å¤šä»»åŠ¡æµ‹è¯•**
   - æ·»åŠ 5ä¸ªä»»åŠ¡
   - è§‚å¯Ÿå¹¶å‘æ§åˆ¶ï¼ˆæœ€å¤š3ä¸ªåŒæ—¶ä¸‹è½½ï¼‰
   - è§‚å¯Ÿé˜Ÿåˆ—ç®¡ç†

3. **å¤§æ–‡ä»¶æµ‹è¯•**
   - ä¸‹è½½1GBæ–‡ä»¶
   - æµ‹è¯•æ–­ç‚¹ç»­ä¼ 
   - æµ‹è¯•åå°ä¸‹è½½

4. **è¾¹ç•Œæµ‹è¯•**
   - æµ‹è¯•æ— æ•ˆURL
   - æµ‹è¯•ç½‘ç»œä¸­æ–­
   - æµ‹è¯•ç£ç›˜ç©ºé—´ä¸è¶³

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ä¸‹è½½é€Ÿåº¦ä¸º0?
**A**: å¯èƒ½æ˜¯ï¼š
- ç½‘ç»œè¿æ¥é—®é¢˜
- æœåŠ¡å™¨å“åº”æ…¢
- ç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆ

### Q2: ä»»åŠ¡ä¸€ç›´ç­‰å¾…ï¼Ÿ
**A**: æ£€æŸ¥ï¼š
- æ˜¯å¦å·²æœ‰3ä¸ªä»»åŠ¡åœ¨ä¸‹è½½
- æŸ¥çœ‹å…¶ä»–ä»»åŠ¡çŠ¶æ€

### Q3: ä¸‹è½½å¤±è´¥ï¼Ÿ
**A**: å¯èƒ½åŸå› ï¼š
- URLæ— æ•ˆ
- ç½‘ç»œæ–­å¼€
- æœåŠ¡å™¨é”™è¯¯
- ç£ç›˜ç©ºé—´ä¸è¶³

è§£å†³æ–¹æ³•ï¼š
- ç‚¹å‡»"é‡è¯•"æŒ‰é’®
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- éªŒè¯URLæ˜¯å¦æ­£ç¡®

### Q4: æ‰¾ä¸åˆ°ä¸‹è½½çš„æ–‡ä»¶ï¼Ÿ
**A**: æ–‡ä»¶ä¿å­˜åœ¨ï¼š
```
Documents/Downloads/æ–‡ä»¶å
```

ä½¿ç”¨ä»£ç è®¿é—®ï¼š
```swift
let task = DownloadManager.shared.getTask(byId: taskId)
if let path = task?.destinationPath {
    print("æ–‡ä»¶è·¯å¾„: \(path.path)")
}
```

---

## ğŸ“š ä¸‹ä¸€æ­¥å­¦ä¹ 

### åˆçº§ï¼šç†è§£åŸºç¡€
1. é˜…è¯» `DownloadTask.swift`
2. ç†è§£ä»»åŠ¡æ¨¡å‹å’ŒçŠ¶æ€
3. å­¦ä¹ è§‚å¯Ÿè€…æ¨¡å¼

### ä¸­çº§ï¼šæŒæ¡æ ¸å¿ƒ
1. é˜…è¯» `DownloadManager.swift`
2. ç†è§£å¹¶å‘æ§åˆ¶é€»è¾‘
3. å­¦ä¹ çº¿ç¨‹å®‰å…¨å®ç°

### é«˜çº§ï¼šæ·±å…¥æ¶æ„
1. é˜…è¯» **æ¶æ„åˆ†æ.md**
2. ç ”ç©¶è®¾è®¡æ¨¡å¼åº”ç”¨
3. å­¦ä¹ æ¶æ„è®¾è®¡æ€æƒ³

### å®æˆ˜ï¼šåŠ¨æ‰‹å®è·µ
1. å‚è€ƒ **ä½¿ç”¨ç¤ºä¾‹.md**
2. å®ç°è‡ªå®šä¹‰åŠŸèƒ½
3. é›†æˆåˆ°è‡ªå·±é¡¹ç›®

---

## ğŸ“ å­¦ä¹ è·¯å¾„

```
ç¬¬1å¤©ï¼šè¿è¡Œé¡¹ç›®ï¼Œä½“éªŒåŠŸèƒ½
  â†“
ç¬¬2å¤©ï¼šé˜…è¯»æ ¸å¿ƒä»£ç ï¼Œç†è§£é€»è¾‘
  â†“
ç¬¬3å¤©ï¼šç ”ç©¶æ¶æ„æ–‡æ¡£ï¼Œå­¦ä¹ è®¾è®¡
  â†“
ç¬¬4å¤©ï¼šä¿®æ”¹ä»£ç ï¼Œæ·»åŠ åŠŸèƒ½
  â†“
ç¬¬5å¤©ï¼šé›†æˆåº”ç”¨ï¼Œå®é™…ä½¿ç”¨
```

---

## ğŸ“– æ¨èé˜…è¯»é¡ºåº

```
1. å¿«é€Ÿå…¥é—¨.md (å½“å‰æ–‡ä»¶) â† ä½ åœ¨è¿™é‡Œ
2. README.md
3. DownloadTask.swift
4. DownloadManager.swift  
5. ViewController.swift
6. æ¶æ„åˆ†æ.md
7. ç±»å›¾å’Œæµç¨‹å›¾.md
8. ä½¿ç”¨ç¤ºä¾‹.md
9. é¡¹ç›®æ€»ç»“.md
```

---

## ğŸ’¡ å°è´´å£«

### Tip 1: ä½¿ç”¨Xcodeè°ƒè¯•
- è®¾ç½®æ–­ç‚¹æŸ¥çœ‹æ‰§è¡Œæµç¨‹
- ä½¿ç”¨ `po` å‘½ä»¤æŸ¥çœ‹å˜é‡å€¼
- è§‚å¯Ÿæ§åˆ¶å°è¾“å‡º

### Tip 2: ä¿®æ”¹æµ‹è¯•URL
ä½¿ç”¨è¿™äº›å…¬å¼€çš„æµ‹è¯•æ–‡ä»¶ï¼š
- 10MB: `https://speed.hetzner.de/10MB.bin`
- 100MB: `https://speed.hetzner.de/100MB.bin`
- 1GB: `https://speed.hetzner.de/1GB.bin`

### Tip 3: æŸ¥çœ‹ä¸‹è½½æ–‡ä»¶
åœ¨Xcodeä¸­ï¼š
1. Window â†’ Devices and Simulators
2. é€‰æ‹©æ¨¡æ‹Ÿå™¨
3. é€‰æ‹©åº”ç”¨
4. æŸ¥çœ‹å®¹å™¨ä¸­çš„æ–‡ä»¶

### Tip 4: æ¸…ç†æµ‹è¯•æ•°æ®
```swift
// åˆ é™¤æ‰€æœ‰ä»»åŠ¡
let tasks = DownloadManager.shared.getAllTasks()
tasks.forEach { task in
    DownloadManager.shared.removeTask(taskId: task.id)
}
```

---

## ğŸ‰ å¼€å§‹ä½ çš„ä¸‹è½½å™¨ä¹‹æ—…ï¼

ç°åœ¨ä½ å·²ç»æŒæ¡äº†åŸºç¡€ä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥ï¼š

1. âœ… è¿è¡Œé¡¹ç›®
2. âœ… æ·»åŠ ä»»åŠ¡
3. âœ… æ§åˆ¶ä¸‹è½½
4. âœ… æŸ¥çœ‹ä»£ç 
5. âœ… ç†è§£åŸç†

**æ¥ä¸‹æ¥ï¼Œæ·±å…¥å­¦ä¹ æ¶æ„è®¾è®¡ï¼ŒæŒæ¡é«˜çº§æŠ€å·§å§ï¼**

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

é‡åˆ°é—®é¢˜æ—¶ï¼š
1. æŸ¥çœ‹ **å¸¸è§é—®é¢˜** éƒ¨åˆ†
2. é˜…è¯»è¯¦ç»†æ–‡æ¡£
3. æ£€æŸ¥ä»£ç æ³¨é‡Š
4. ä½¿ç”¨è°ƒè¯•å·¥å…·

**ç¥å­¦ä¹ æ„‰å¿«ï¼ğŸš€**

