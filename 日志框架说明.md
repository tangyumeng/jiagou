# 日志框架 - 多级别日志系统

## 📦 功能概述

实现了一个完整的**多级别日志框架**，支持多种输出目标、自定义格式化器、日志持久化和远程上报等功能。

---

## ✨ 核心特性

### 1. **六个日志级别**
```swift
.verbose  💬  // 详细信息
.debug    🐛  // 调试信息
.info     ℹ️   // 一般信息
.warning  ⚠️   // 警告
.error    ❌  // 错误
.fatal    💀  // 致命错误
```

### 2. **多种输出目标**
- ✅ **控制台** - 实时输出到 Xcode Console
- ✅ **文件** - 持久化到本地文件
- ✅ **远程** - 上报到服务器

### 3. **多种格式化器**
- ✅ **默认格式** - 包含时间、级别、文件、行号等
- ✅ **简单格式** - 只显示级别和消息
- ✅ **JSON 格式** - 用于上报服务器

### 4. **智能管理**
- ✅ 日志文件自动轮转（超过 5MB）
- ✅ 自动清理旧日志（保留最新 10 个）
- ✅ 异步写入（不阻塞主线程）
- ✅ 线程安全

---

## 💻 使用方法

### 1. 基本使用

```swift
import UIKit

// 方式1：使用 Logger
Logger.shared.info("应用启动")
Logger.shared.warning("网络请求超时")
Logger.shared.error("解析JSON失败")

// 方式2：使用全局函数（更简洁）
logInfo("应用启动")
logWarning("网络请求超时")
logError("解析JSON失败")

// 自动包含文件、函数、行号信息
logDebug("用户ID：\(userId)")
// 输出：[2025-10-13 10:30:45.123] [🐛 DEBUG] [main] [ViewController.swift:45 viewDidLoad()] 用户ID：123
```

### 2. 添加文件输出

```swift
// AppDelegate.swift

func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
    
    // 添加文件输出
    let fileDestination = FileLogDestination()
    fileDestination.minLevel = .info  // 只记录 info 及以上级别
    Logger.shared.addDestination(fileDestination)
    
    // 添加远程上报
    let remoteDestination = RemoteLogDestination(serverURL: "https://api.example.com/logs")
    remoteDestination.minLevel = .error  // 只上报错误
    Logger.shared.addDestination(remoteDestination)
    
    return true
}
```

### 3. 自定义格式

```swift
// 使用简单格式
let console = ConsoleLogDestination()
console.formatter = SimpleLogFormatter()
Logger.shared.addDestination(console)

// 输出：ℹ️ [INFO] 应用启动
```

### 4. 设置日志级别

```swift
// Debug 环境：显示所有日志
#if DEBUG
Logger.shared.minLevel = .verbose
#else
// Release 环境：只显示 info 及以上
Logger.shared.minLevel = .info
#endif
```

### 5. 查看和清理日志文件

```swift
let fileDestination = FileLogDestination()

// 获取所有日志文件
let files = fileDestination.getAllLogFiles()
print("日志文件数量：\(files.count)")

// 清空所有日志
fileDestination.clearAllLogs()
```

---

## 🎯 面试要点

### 1. 为什么需要日志框架？

```
✅ 问题定位：快速找到 bug 原因
✅ 用户反馈：了解线上问题
✅ 性能监控：记录性能指标
✅ 行为分析：分析用户行为
✅ 审计追踪：记录关键操作
```

### 2. 为什么需要多个日志级别？

```
不同场景需要不同详细程度：

开发阶段：.verbose（最详细）
测试阶段：.debug
生产环境：.info（只记录重要信息）
紧急排查：.error（只看错误）
```

### 3. 为什么需要多个输出目标？

```
控制台：开发时实时查看
文件：离线分析，用户反馈
远程：集中管理，实时监控

不同目标可以设置不同级别：
- 控制台：所有日志
- 文件：info 及以上
- 远程：只上报 error
```

### 4. 如何保证性能？

```swift
// 1. 异步写入
queue.async {
    // 写文件操作
}

// 2. 级别过滤（提前退出）
guard level >= minLevel else { return }

// 3. 日志轮转（避免文件过大）
if fileSize > 5MB {
    rotateFile()
}

// 4. 批量上报（减少网络请求）
if buffer.count >= 10 {
    flush()
}
```

---

## 💡 总结

### 实现的功能
✅ 六个日志级别  
✅ 三种输出目标  
✅ 三种格式化器  
✅ 文件自动轮转  
✅ 异步写入  
✅ 线程安全  

### 技术亮点
⭐ 完整的日志架构  
⭐ 高性能设计  
⭐ 灵活的扩展性  

---

**日志框架是线上问题排查的利器！📝**

