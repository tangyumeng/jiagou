# MVVM è®¾è®¡æ¨¡å¼æ¼”ç¤ºä½¿ç”¨è¯´æ˜

## ğŸ“± åŠŸèƒ½æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«å®Œæ•´çš„ MVVM (Model-View-ViewModel) è®¾è®¡æ¨¡å¼æ¼”ç¤ºï¼Œå±•ç¤ºäº†ç°ä»£ iOS å¼€å‘çš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬ï¼š

- âœ… å®Œæ•´çš„ MVVM ä¸‰å±‚æ¶æ„å®ç°
- âœ… SwiftUI + UIKit æ··åˆå¼€å‘
- âœ… æ•°æ®ç»‘å®šå’Œå“åº”å¼ç¼–ç¨‹
- âœ… ç”¨æˆ·åˆ—è¡¨ç®¡ç†ï¼ˆæœç´¢ã€æ’åºã€è¿‡æ»¤ï¼‰
- âœ… ç”¨æˆ·è¯¦æƒ…ç¼–è¾‘
- âœ… ç”¨æˆ·ç™»å½•æ¼”ç¤º
- âœ… æ¶æ„å›¾å’Œä»£ç ç¤ºä¾‹

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### æ–¹å¼ä¸€ï¼šä»ä¸»é¡µè¿›å…¥

1. è¿è¡Œé¡¹ç›®
2. åœ¨ä¸»é¡µæ‰¾åˆ° **"MVVM æ¶æ„æ¼”ç¤º"** æŒ‰é’®
3. ç‚¹å‡»è¿›å…¥ MVVM æ¼”ç¤ºä¸»ç•Œé¢

### æ–¹å¼äºŒï¼šä»£ç å¯åŠ¨

åœ¨ `HomeViewController.swift` ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```swift
@objc private func showMVVMDemo() {
    let mvvmVC = MVVMDemoViewController()
    navigationController?.pushViewController(mvvmVC, animated: true)
}
```

---

## ğŸ“Š åŠŸèƒ½è¯¦è§£

### 1. ç”¨æˆ·åˆ—è¡¨æ¼”ç¤º (SwiftUI)

**å…¥å£**: ç‚¹å‡» "ğŸ“± ç”¨æˆ·åˆ—è¡¨æ¼”ç¤º (SwiftUI)" æŒ‰é’®

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… ç”¨æˆ·åˆ—è¡¨å±•ç¤º
- âœ… æœç´¢åŠŸèƒ½ï¼ˆæŒ‰å§“åæˆ–é‚®ç®±æœç´¢ï¼‰
- âœ… è¿‡æ»¤åŠŸèƒ½ï¼ˆåªæ˜¾ç¤ºåœ¨çº¿ç”¨æˆ·ï¼‰
- âœ… æ’åºåŠŸèƒ½ï¼ˆæŒ‰å§“åã€é‚®ç®±ã€ç™»å½•æ—¶é—´ã€ç™»å½•æ¬¡æ•°ï¼‰
- âœ… åˆ é™¤ç”¨æˆ·ï¼ˆæ»‘åŠ¨åˆ é™¤ï¼‰
- âœ… ä¸‹æ‹‰åˆ·æ–°
- âœ… åŠ è½½çŠ¶æ€æ˜¾ç¤º
- âœ… ç©ºçŠ¶æ€æ˜¾ç¤º
- âœ… é”™è¯¯å¤„ç†

**æ“ä½œç¤ºä¾‹**:
```swift
// 1. æœç´¢ç”¨æˆ·
åœ¨æœç´¢æ¡†è¾“å…¥ "å¼ ä¸‰" â†’ è‡ªåŠ¨è¿‡æ»¤æ˜¾ç¤ºç»“æœ

// 2. è¿‡æ»¤åœ¨çº¿ç”¨æˆ·
ç‚¹å‡» "ä»…åœ¨çº¿" æŒ‰é’® â†’ åªæ˜¾ç¤ºåœ¨çº¿ç”¨æˆ·

// 3. æ’åº
ç‚¹å‡» "æ’åº" èœå• â†’ é€‰æ‹©æ’åºæ–¹å¼

// 4. åˆ é™¤ç”¨æˆ·
å‘å·¦æ»‘åŠ¨ç”¨æˆ·è¡Œ â†’ ç‚¹å‡»åˆ é™¤
```

### 2. ç”¨æˆ·è¯¦æƒ…æ¼”ç¤º (SwiftUI)

**å…¥å£**: åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­ç‚¹å‡»ä»»æ„ç”¨æˆ·

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… ç”¨æˆ·ä¿¡æ¯å±•ç¤º
- âœ… ç¼–è¾‘æ¨¡å¼åˆ‡æ¢
- âœ… å®æ—¶æ•°æ®éªŒè¯
- âœ… åœ¨çº¿çŠ¶æ€åˆ‡æ¢
- âœ… æ“ä½œç»“æœæç¤º

**æ“ä½œç¤ºä¾‹**:
```swift
// 1. ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯
ç‚¹å‡» "ç¼–è¾‘" æŒ‰é’® â†’ ä¿®æ”¹ä¿¡æ¯ â†’ ç‚¹å‡» "ä¿å­˜"

// 2. åˆ‡æ¢åœ¨çº¿çŠ¶æ€
ç‚¹å‡» "è®¾ä¸ºåœ¨çº¿/ç¦»çº¿" æŒ‰é’® â†’ è‡ªåŠ¨æ›´æ–°çŠ¶æ€

// 3. å–æ¶ˆç¼–è¾‘
ç¼–è¾‘æ¨¡å¼ä¸‹ç‚¹å‡» "å–æ¶ˆ" â†’ æ¢å¤åŸå§‹æ•°æ®
```

### 3. ç”¨æˆ·ç™»å½•æ¼”ç¤º (SwiftUI)

**å…¥å£**: ç‚¹å‡» "ğŸ” ç”¨æˆ·ç™»å½•æ¼”ç¤º (SwiftUI)" æŒ‰é’®

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… ç™»å½•è¡¨å•
- âœ… å®æ—¶è¾“å…¥éªŒè¯
- âœ… ç™»å½•æŒ‰é’®å¯ç”¨/ç¦ç”¨
- âœ… å¼‚æ­¥ç™»å½•å¤„ç†
- âœ… åŠ è½½çŠ¶æ€æ˜¾ç¤º
- âœ… é”™è¯¯æç¤º

**æ“ä½œç¤ºä¾‹**:
```swift
// 1. è¾“å…¥æ­£ç¡®çš„ç™»å½•ä¿¡æ¯
é‚®ç®±: test@example.com
å¯†ç : 123456 (è‡³å°‘6ä½)
â†’ ç™»å½•æŒ‰é’®å˜ä¸ºå¯ç”¨ â†’ ç‚¹å‡»ç™»å½•

// 2. è¾“å…¥é”™è¯¯çš„ç™»å½•ä¿¡æ¯
é‚®ç®±: invalid
å¯†ç : 123
â†’ æ˜¾ç¤ºé”™è¯¯æç¤º
```

### 4. MVVM æ¶æ„å›¾

**å…¥å£**: ç‚¹å‡» "ğŸ—ï¸ MVVM æ¶æ„å›¾" æŒ‰é’®

**å†…å®¹**:
- MVVM ä¸‰å±‚æ¶æ„å›¾
- æ•°æ®æµå‘è¯´æ˜
- èŒè´£åˆ†ç¦»è¯´æ˜
- æ¶æ„ä¼˜åŠ¿ä»‹ç»

### 5. ä»£ç ç¤ºä¾‹è¯´æ˜

**å…¥å£**: ç‚¹å‡» "ğŸ’» ä»£ç ç¤ºä¾‹è¯´æ˜" æŒ‰é’®

**å†…å®¹**:
- Model å±‚ä»£ç ç¤ºä¾‹
- ViewModel å±‚ä»£ç ç¤ºä¾‹
- View å±‚ä»£ç ç¤ºä¾‹
- æ•°æ®ç»‘å®šç¤ºä¾‹
- æœåŠ¡å±‚ç¤ºä¾‹
- MVVM ä¼˜åŠ¿æ€»ç»“

---

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### MVVM ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              View Layer             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   SwiftUI   â”‚ â”‚   UIKit     â”‚   â”‚
â”‚  â”‚    Views    â”‚ â”‚   Views     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ æ•°æ®ç»‘å®š (@Published)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ViewModel Layer           â”‚
â”‚  â€¢ MVVMUserListViewModel            â”‚
â”‚  â€¢ MVVMUserDetailViewModel          â”‚
â”‚  â€¢ MVVMUserLoginViewModel           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ æ•°æ®è®¿é—®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Model Layer              â”‚
â”‚  â€¢ MVVMUserModel                    â”‚
â”‚  â€¢ UserDataService                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

| æ–‡ä»¶å | ä½œç”¨ | å±‚æ¬¡ |
|--------|------|------|
| `MVVMUserModel.swift` | ç”¨æˆ·æ•°æ®æ¨¡å‹ã€æ•°æ®éªŒè¯ã€æ•°æ®æœåŠ¡ | Model å±‚ |
| `MVVMUserViewModel.swift` | ä¸šåŠ¡é€»è¾‘ã€çŠ¶æ€ç®¡ç†ã€æ•°æ®å¤„ç† | ViewModel å±‚ |
| `MVVMUserView.swift` | UI ç»„ä»¶ã€æ•°æ®ç»‘å®šã€ç”¨æˆ·äº¤äº’ | View å±‚ |
| `MVVMDemoViewController.swift` | æ¼”ç¤ºå…¥å£ã€æ¶æ„è¯´æ˜ã€ä»£ç ç¤ºä¾‹ | æ¼”ç¤ºå±‚ |

---

## ğŸ’¡ æ ¸å¿ƒç‰¹æ€§

### 1. æ•°æ®ç»‘å®š

ä½¿ç”¨ SwiftUI çš„ `@Published` å’Œ `@StateObject` å®ç°è‡ªåŠ¨ UI æ›´æ–°ï¼š

```swift
// ViewModel ä¸­å®šä¹‰
@Published var users: [MVVMUserModel] = []

// View ä¸­ç»‘å®š
@StateObject private var viewModel = MVVMUserListViewModel()

// è‡ªåŠ¨æ›´æ–°
List {
    ForEach(viewModel.users, id: \.id) { user in
        UserRowView(user: user)
    }
}
```

### 2. çŠ¶æ€ç®¡ç†

ä½¿ç”¨æšä¸¾ç®¡ç†å¤æ‚çŠ¶æ€ï¼š

```swift
enum UserListState {
    case loading         // åŠ è½½ä¸­
    case loaded([MVVMUserModel])  // å·²åŠ è½½
    case error(String)   // é”™è¯¯
    case empty           // ç©ºåˆ—è¡¨
}
```

### 3. å“åº”å¼ç¼–ç¨‹

ä½¿ç”¨ Combine æ¡†æ¶å®ç°å“åº”å¼é€»è¾‘ï¼š

```swift
$email.combineLatest($password)
    .map { email, password in
        !email.isEmpty && !password.isEmpty
    }
    .assign(to: &$isLoginEnabled)
```

### 4. æ•°æ®éªŒè¯

Model å±‚æä¾›æ•°æ®éªŒè¯æ–¹æ³•ï¼š

```swift
extension MVVMUserModel {
    var isValid: Bool { ... }
    var isEmailValid: Bool { ... }
    var validationErrors: [String] { ... }
}
```

---

## ğŸ¯ è®¾è®¡æ¨¡å¼è¦ç‚¹

### Model å±‚èŒè´£
- âœ… å®šä¹‰æ•°æ®ç»“æ„
- âœ… æ•°æ®éªŒè¯é€»è¾‘
- âœ… æ•°æ®æ ¼å¼åŒ–
- âœ… æ•°æ®æœåŠ¡æ¥å£
- âŒ ä¸åŒ…å« UI é€»è¾‘
- âŒ ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘

### ViewModel å±‚èŒè´£
- âœ… ä¸šåŠ¡é€»è¾‘å¤„ç†
- âœ… çŠ¶æ€ç®¡ç†
- âœ… æ•°æ®è½¬æ¢
- âœ… å¼‚æ­¥æ“ä½œ
- âœ… ä¸ Model å±‚é€šä¿¡
- âŒ ä¸åŒ…å« UI ä»£ç 
- âŒ ä¸ç›´æ¥æ“ä½œ View

### View å±‚èŒè´£
- âœ… UI å±•ç¤º
- âœ… ç”¨æˆ·äº¤äº’
- âœ… æ•°æ®ç»‘å®š
- âœ… å¸ƒå±€å’Œæ ·å¼
- âŒ ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- âŒ ä¸ç›´æ¥è®¿é—® Model

---

## ğŸ”„ æ•°æ®æµå‘

### ç”¨æˆ·æ“ä½œæµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»æŒ‰é’®
   â†“
2. View è°ƒç”¨ ViewModel æ–¹æ³•
   viewModel.loadUsers()
   â†“
3. ViewModel è°ƒç”¨ Model æœåŠ¡
   userDataService.fetchUsers()
   â†“
4. Model æ‰§è¡Œç½‘ç»œè¯·æ±‚
   URLSession.dataTask()
   â†“
5. æ•°æ®è¿”å›åˆ° ViewModel
   completion(users)
   â†“
6. ViewModel æ›´æ–° @Published å±æ€§
   self.users = users
   â†“
7. View è‡ªåŠ¨åˆ·æ–°
   List { ForEach(viewModel.users) }
```

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### ViewModel å•å…ƒæµ‹è¯•

```swift
func testLoadUsers() {
    // å‡†å¤‡
    let mockService = MockUserDataService()
    let viewModel = MVVMUserListViewModel(userDataService: mockService)
    
    // æ‰§è¡Œ
    viewModel.loadUsers()
    
    // éªŒè¯
    XCTAssertTrue(viewModel.isLoading)
    
    // ç­‰å¾…å¼‚æ­¥å®Œæˆ
    let expectation = XCTestExpectation(description: "Load users")
    DispatchQueue.main.asyncAfter(deadline: .now() + 1.5) {
        XCTAssertEqual(viewModel.userCount, 5)
        expectation.fulfill()
    }
    
    wait(for: [expectation], timeout: 2.0)
}
```

### Mock æœåŠ¡å®ç°

```swift
class MockUserDataService: UserDataServiceProtocol {
    var mockUsers: [MVVMUserModel] = []
    
    func fetchUsers(completion: @escaping ([MVVMUserModel]) -> Void) {
        completion(mockUsers)
    }
}
```

---

## ğŸ› ï¸ è‡ªå®šä¹‰å’Œæ‰©å±•

### æ·»åŠ æ–°çš„ ViewModel

1. åˆ›å»ºæ–°çš„çŠ¶æ€æšä¸¾
```swift
enum NewFeatureState {
    case idle
    case loading
    case success
}
```

2. åˆ›å»º ViewModel ç±»
```swift
class NewFeatureViewModel: ObservableObject {
    @Published var state: NewFeatureState = .idle
    
    func performAction() {
        state = .loading
        // æ‰§è¡Œæ“ä½œ
        state = .success
    }
}
```

3. åœ¨ View ä¸­ä½¿ç”¨
```swift
struct NewFeatureView: View {
    @StateObject private var viewModel = NewFeatureViewModel()
    
    var body: some View {
        // UI ä»£ç 
    }
}
```

### æ·»åŠ æ–°çš„æ•°æ®æ¨¡å‹

1. å®šä¹‰ Model
```swift
struct ProductModel {
    let id: String
    var name: String
    var price: Double
}
```

2. åˆ›å»ºæœåŠ¡åè®®
```swift
protocol ProductServiceProtocol {
    func fetchProducts(completion: @escaping ([ProductModel]) -> Void)
}
```

3. å®ç°æœåŠ¡
```swift
class ProductService: ProductServiceProtocol {
    func fetchProducts(completion: @escaping ([ProductModel]) -> Void) {
        // å®ç°é€»è¾‘
    }
}
```

---

## ğŸ“š å­¦ä¹ è¦ç‚¹

### 1. æ•°æ®ç»‘å®š
- ä½¿ç”¨ `@Published` æ ‡è®°éœ€è¦è‡ªåŠ¨æ›´æ–°çš„å±æ€§
- ä½¿ç”¨ `@StateObject` æŒæœ‰ ViewModel
- ä½¿ç”¨ `@ObservedObject` ä¼ é€’ ViewModel

### 2. çŠ¶æ€ç®¡ç†
- ä½¿ç”¨æšä¸¾ç®¡ç†å¤æ‚çŠ¶æ€
- çŠ¶æ€å˜åŒ–è§¦å‘ UI æ›´æ–°
- ç»Ÿä¸€çš„çŠ¶æ€è½¬æ¢é€»è¾‘

### 3. å¼‚æ­¥å¤„ç†
- æ‰€æœ‰ç½‘ç»œè¯·æ±‚åœ¨ ViewModel ä¸­å¤„ç†
- ä½¿ç”¨ completion å›è°ƒè¿”å›ç»“æœ
- ä¸»çº¿ç¨‹æ›´æ–° UI

### 4. ä¾èµ–æ³¨å…¥
- ViewModel é€šè¿‡åˆå§‹åŒ–å‚æ•°æ¥æ”¶ä¾èµ–
- ä¾¿äºå•å…ƒæµ‹è¯•
- æé«˜ä»£ç çµæ´»æ€§

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å†…å­˜ç®¡ç†
- ViewModel ä¸­ä½¿ç”¨ `[weak self]` é¿å…å¾ªç¯å¼•ç”¨
- SwiftUI çš„ `@StateObject` ä¼šè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
- åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„è®¢é˜…

### 2. çº¿ç¨‹å®‰å…¨
- UI æ›´æ–°å¿…é¡»åœ¨ä¸»çº¿ç¨‹
- ä½¿ç”¨ `DispatchQueue.main.async` åˆ‡æ¢çº¿ç¨‹
- å¼‚æ­¥æ“ä½œè¦å¤„ç†å–æ¶ˆæƒ…å†µ

### 3. æ€§èƒ½ä¼˜åŒ–
- é¿å…åœ¨ `@Published` å±æ€§ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
- åˆç†ä½¿ç”¨è®¡ç®—å±æ€§
- å‡å°‘ä¸å¿…è¦çš„ UI åˆ·æ–°

---

## ğŸ¨ UI æ¼”ç¤ºæˆªå›¾è¯´æ˜

### ç”¨æˆ·åˆ—è¡¨ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·åˆ—è¡¨                    [åˆ·æ–°] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” æœç´¢ç”¨æˆ·                      â”‚
â”‚  â˜‘ï¸ ä»…åœ¨çº¿    æ’åº â–¼              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ å¼ ä¸‰                      ğŸŸ¢ â”‚
â”‚     zhangsan@example.com         â”‚
â”‚     2025-10-16 18:30 â€¢ ç™»å½•5æ¬¡   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ æå››                      âšª â”‚
â”‚     lisi@example.com             â”‚
â”‚     2025-10-15 09:20 â€¢ ç™»å½•3æ¬¡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”¨æˆ·è¯¦æƒ…ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  < ç”¨æˆ·è¯¦æƒ…                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        ğŸ‘¤ å¼ ä¸‰                    â”‚
â”‚    zhangsan@example.com          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·ä¿¡æ¯              [ç¼–è¾‘]     â”‚
â”‚  ç”¨æˆ·ID:     123                 â”‚
â”‚  å§“å:       å¼ ä¸‰                 â”‚
â”‚  é‚®ç®±:       zhangsan@...        â”‚
â”‚  çŠ¶æ€:       åœ¨çº¿                 â”‚
â”‚  æœ€åç™»å½•:   2025-10-16 18:30    â”‚
â”‚  ç™»å½•æ¬¡æ•°:   5æ¬¡                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ ğŸ“¶ è®¾ä¸ºç¦»çº¿ ]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”¨æˆ·ç™»å½•ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·ç™»å½•                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚
â”‚  é‚®ç®±åœ°å€                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ è¯·è¾“å…¥é‚®ç®±                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚
â”‚  å¯†ç                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         ç™»å½•              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“– ä»£ç ç¤ºä¾‹

### å®Œæ•´çš„ MVVM å®ç°ç¤ºä¾‹

#### Model å±‚

```swift
// æ•°æ®æ¨¡å‹
struct UserModel {
    let id: String
    var name: String
    var email: String
}

// æ•°æ®æœåŠ¡åè®®
protocol UserServiceProtocol {
    func fetchUsers(completion: @escaping ([UserModel]) -> Void)
}

// æ•°æ®æœåŠ¡å®ç°
class UserService: UserServiceProtocol {
    func fetchUsers(completion: @escaping ([UserModel]) -> Void) {
        // ç½‘ç»œè¯·æ±‚é€»è¾‘
    }
}
```

#### ViewModel å±‚

```swift
class UserListViewModel: ObservableObject {
    // å‘å¸ƒå±æ€§ï¼ˆè‡ªåŠ¨è§¦å‘ UI æ›´æ–°ï¼‰
    @Published var users: [UserModel] = []
    @Published var isLoading: Bool = false
    
    private let userService: UserServiceProtocol
    
    init(userService: UserServiceProtocol) {
        self.userService = userService
        loadUsers()
    }
    
    func loadUsers() {
        isLoading = true
        userService.fetchUsers { [weak self] users in
            DispatchQueue.main.async {
                self?.users = users
                self?.isLoading = false
            }
        }
    }
}
```

#### View å±‚

```swift
struct UserListView: View {
    @StateObject private var viewModel = UserListViewModel(
        userService: UserService()
    )
    
    var body: some View {
        NavigationView {
            if viewModel.isLoading {
                ProgressView("åŠ è½½ä¸­...")
            } else {
                List(viewModel.users, id: \.id) { user in
                    Text(user.name)
                }
            }
        }
        .navigationTitle("ç”¨æˆ·åˆ—è¡¨")
    }
}
```

---

## âœ¨ MVVM ä¼˜åŠ¿

### 1. èŒè´£åˆ†ç¦»æ¸…æ™°
- Model: çº¯æ•°æ®ï¼Œæ— ä¸šåŠ¡é€»è¾‘
- View: çº¯ UIï¼Œæ— ä¸šåŠ¡é€»è¾‘
- ViewModel: çº¯ä¸šåŠ¡é€»è¾‘ï¼Œæ—  UI ä¾èµ–

### 2. æ˜“äºæµ‹è¯•
- ViewModel å¯ç‹¬ç«‹æµ‹è¯•
- ä¸ä¾èµ– UI æ¡†æ¶
- æ”¯æŒ Mock æ•°æ®æœåŠ¡

### 3. ä»£ç å¤ç”¨
- ViewModel å¯åœ¨ä¸åŒ View ä¸­å¤ç”¨
- ä¸šåŠ¡é€»è¾‘é›†ä¸­ç®¡ç†
- å‡å°‘ä»£ç é‡å¤

### 4. ç»´æŠ¤æ€§å¼º
- ä»£ç ç»“æ„æ¸…æ™°
- æ¨¡å—åŒ–è®¾è®¡
- æ˜“äºæ‰©å±•

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä½¿ç”¨ MVVM è€Œä¸æ˜¯ MVCï¼Ÿ

**A**: MVVM ç›¸æ¯” MVC çš„ä¼˜åŠ¿ï¼š
- æ›´å¥½çš„èŒè´£åˆ†ç¦»
- ViewModel å¯æµ‹è¯•æ€§æ›´å¼º
- æ•°æ®ç»‘å®šå‡å°‘ä»£ç é‡
- æ›´é€‚åˆ SwiftUI å¼€å‘

### Q2: @Published å’Œ @State æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A**: 
- `@Published`: ç”¨äº ViewModelï¼Œå‘å¸ƒå±æ€§å˜åŒ–
- `@State`: ç”¨äº Viewï¼Œç®¡ç†æœ¬åœ°çŠ¶æ€
- `@StateObject`: ç”¨äºæŒæœ‰ ViewModel å®ä¾‹
- `@ObservedObject`: ç”¨äºæ¥æ”¶ä¼ å…¥çš„ ViewModel

### Q3: ä½•æ—¶ä½¿ç”¨ SwiftUIï¼Œä½•æ—¶ä½¿ç”¨ UIKitï¼Ÿ

**A**:
- SwiftUI: æ–°é¡¹ç›®ã€ç®€å•ç•Œé¢ã€å¿«é€Ÿå¼€å‘
- UIKit: å¤æ‚åŠ¨ç”»ã€è‡ªå®šä¹‰æ§ä»¶ã€å…¼å®¹æ—§ç‰ˆæœ¬
- æ··åˆä½¿ç”¨: åˆ©ç”¨å„è‡ªä¼˜åŠ¿ï¼Œäº’è¡¥ä¸è¶³

### Q4: å¦‚ä½•åœ¨ ViewModel ä¸­å¤„ç†å¼‚æ­¥æ“ä½œï¼Ÿ

**A**:
```swift
func loadData() {
    state = .loading
    
    service.fetchData { [weak self] result in
        DispatchQueue.main.async {
            switch result {
            case .success(let data):
                self?.data = data
                self?.state = .success
            case .failure(let error):
                self?.state = .error(error.localizedDescription)
            }
        }
    }
}
```

---

## ğŸ“ æ€»ç»“

æœ¬ MVVM æ¼”ç¤ºå±•ç¤ºäº†ï¼š

1. âœ… å®Œæ•´çš„ä¸‰å±‚æ¶æ„å®ç°
2. âœ… æ•°æ®ç»‘å®šå’Œå“åº”å¼ç¼–ç¨‹
3. âœ… çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ
4. âœ… SwiftUI + UIKit æ··åˆå¼€å‘
5. âœ… ä¾èµ–æ³¨å…¥å’Œå¯æµ‹è¯•æ€§
6. âœ… é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

è¿™æ˜¯å­¦ä¹ ç°ä»£ iOS å¼€å‘çš„ä¼˜ç§€ç¤ºä¾‹ï¼Œå±•ç¤ºäº† MVVM è®¾è®¡æ¨¡å¼åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨ã€‚

---

## ğŸš€ ä¸‹ä¸€æ­¥

- å°è¯•ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
- ä½“éªŒæœç´¢å’Œè¿‡æ»¤åŠŸèƒ½
- æŸ¥çœ‹æ¶æ„å›¾å’Œä»£ç ç¤ºä¾‹
- ç†è§£æ•°æ®æµå‘
- å‚è€ƒä»£ç ç¼–å†™è‡ªå·±çš„ MVVM æ¨¡å—

ç¥å­¦ä¹ æ„‰å¿«ï¼ğŸ‰

